<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ì•Œë¹„ì˜¨ ëª…í’ˆ ë¬´ì—­ ìµœì í™” ê³„ì‚°ê¸°</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
            border-radius: 20px 20px 0 0;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 16px;
        }
        
        .content {
            display: flex;
            gap: 20px;
            padding: 40px;
            align-items: flex-start;
        }
        
        .main-content {
            flex: 1;
            order: 1;
        }
        
        .sidebar {
            width: 350px;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            height: fit-content;
            position: sticky;
            top: 20px;
            align-self: flex-start;
            max-height: calc(100vh - 40px);
            overflow-y: auto;
            order: 2;
        }
        
        .sidebar h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
            text-align: center;
        }
        
        .efficiency-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }
        
        .efficiency-item.best {
            border-left-color: #28a745;
            background: #e8f5e8;
        }
        
        .efficiency-item h4 {
            margin: 0 0 8px 0;
            font-size: 14px;
            color: #333;
        }
        
        .efficiency-stats {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #666;
        }
        
        .efficiency-value {
            font-weight: bold;
            color: #667eea;
        }
        
        .efficiency-value.best {
            color: #28a745;
        }
        
        .step-container {
            margin-bottom: 40px;
        }
        
        .step-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
        }
        
        .step-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
        }
        
        .step-content {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }
        
        .price-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .price-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }
        
        .price-item:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
        }
        
        .price-item h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .price-input-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .price-input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .price-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .investment-section {
            background: white;
            padding: 25px;
            border-radius: 12px;
            border: 2px solid #e9ecef;
            text-align: center;
        }
        
        .investment-input {
            width: 300px;
            padding: 15px 20px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 18px;
            text-align: center;
            margin: 0 10px;
            transition: border-color 0.3s ease;
        }
        
        .investment-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .optimize-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
        }
        
        .optimize-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }
        
        .optimize-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .results-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }
        
        .optimal-result {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(79, 172, 254, 0.3);
        }
        
        .optimal-result h3 {
            margin-bottom: 20px;
            font-size: 20px;
        }
        
        .optimal-details {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        
        .calculation-result {
            background: white;
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #e9ecef;
        }
        
        .calculation-result h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 20px;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .result-item:last-child {
            border-bottom: none;
        }
        
        .result-label {
            font-weight: 600;
            color: #666;
        }
        
        .result-value {
            font-weight: bold;
            color: #333;
        }
        
        .profit-positive {
            color: #28a745;
        }
        
        .profit-negative {
            color: #dc3545;
        }
        
        .mode-toggle {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .mode-btn {
            padding: 10px 20px;
            margin: 0 10px;
            border: 2px solid #667eea;
            border-radius: 25px;
            background: white;
            color: #667eea;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .mode-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .content {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                order: -1;
                position: relative;
                top: auto;
                max-height: none;
            }
            
            .results-section {
                grid-template-columns: 1fr;
            }
            
            .price-grid {
                grid-template-columns: 1fr;
            }
            
            .investment-input {
                width: 100%;
                max-width: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="header">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h1 id="main-title">ğŸª ì•Œë¹„ì˜¨ ëª…í’ˆ ë¬´ì—­ ìµœì í™” ê³„ì‚°ê¸°</h1>
                    <p id="main-subtitle">ë‹¨ê³„ë³„ ê°€ì´ë“œë¡œ ìµœì ì˜ ë¬´ì—­ ìˆ˜ìµì„ ì°¾ì•„ë³´ì„¸ìš”</p>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button onclick="setLanguage('ko')" id="lang-ko" style="padding: 8px 12px; border: 2px solid white; background: white; color: #667eea; border-radius: 20px; cursor: pointer; font-weight: 600;">ğŸ‡°ğŸ‡· í•œêµ­ì–´</button>
                    <button onclick="setLanguage('en')" id="lang-en" style="padding: 8px 12px; border: 2px solid rgba(255,255,255,0.5); background: transparent; color: white; border-radius: 20px; cursor: pointer; font-weight: 600;">ğŸ‡ºğŸ‡¸ English</button>
                </div>
            </div>
        </div>
        
        <div class="content">
            <!-- ì‚¬ì´ë“œë°”: ì…ë ¥ í¼ + íš¨ìœ¨ì„± ë¹„êµ -->
            <div class="sidebar">
                <!-- ê±°ë˜ ëª¨ë“œ ì„ íƒ -->
                <div style="margin-bottom: 20px;">
                    <h3 style="margin-bottom: 10px;">âš™ï¸ ê±°ë˜ ëª¨ë“œ</h3>
                    <div class="mode-toggle" style="margin-bottom: 0;">
                        <button class="mode-btn" onclick="setMode(93.5)" style="font-size: 12px; padding: 8px 12px;">êµ¬ë§¤ê³„ì•½ì„œ (93.5%)</button>
                        <button class="mode-btn active" onclick="setMode(96)" style="font-size: 12px; padding: 8px 12px;">ì¼ë°˜ê±°ë˜ (96%)</button>
                    </div>
                </div>
                
                <!-- ì•„ì´í…œ ì‹œì„¸ ì…ë ¥ -->
                <div style="margin-bottom: 25px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 style="margin: 0;">ğŸ’° ì•„ì´í…œ ì‹œì„¸</h3>
                        <button id="fetch-btn" onclick="fetchPrices()" style="padding: 6px 12px; border: 1px solid #667eea; background: white; color: #667eea; border-radius: 15px; cursor: pointer; font-size: 11px; font-weight: 600;" onmouseover="this.style.background='#667eea'; this.style.color='white'" onmouseout="this.style.background='white'; this.style.color='#667eea'">ğŸ”„ ì‹¤ì‹œê°„</button>
                    </div>
                    <div style="display: grid; gap: 12px;">
                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px;">
                            <div style="font-size: 12px; color: #666; margin-bottom: 5px;">ğŸ“¦ 2.5kg (1,000ì›)</div>
                            <input type="number" class="price-input" id="price-1" placeholder="600" oninput="updateInputs()" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                        </div>
                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px;">
                            <div style="font-size: 12px; color: #666; margin-bottom: 5px;">ğŸ“¦ 5kg (5,000ì›)</div>
                            <input type="number" class="price-input" id="price-0" placeholder="3000" oninput="updateInputs()" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                        </div>
                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px;">
                            <div style="font-size: 12px; color: #666; margin-bottom: 5px;">ğŸ“¦ 6.3kg (25,000ì›)</div>
                            <input type="number" class="price-input" id="price-2" placeholder="15000" oninput="updateInputs()" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                        </div>
                    </div>
                </div>
                
                <!-- íˆ¬ì ê¸ˆì•¡ ì…ë ¥ -->
                <div style="margin-bottom: 25px;">
                    <h3 style="margin-bottom: 15px;">ğŸ’µ íˆ¬ì ê¸ˆì•¡</h3>
                    <div style="background: #f8f9fa; padding: 12px; border-radius: 8px;">
                        <input type="text" id="investment-amount" placeholder="1,000,000" oninput="formatInvestmentInput()" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; text-align: center;">
                        <div style="font-size: 11px; color: #666; text-align: center; margin-top: 5px;">ì‹¤ë²„</div>
                    </div>
                </div>
                
                <!-- ìµœì í™” ë²„íŠ¼ -->
                <div style="margin-bottom: 25px; text-align: center;">
                    <button class="optimize-btn" id="optimize-btn" onclick="findBothOptimalSettings()" disabled style="width: 100%; padding: 12px; font-size: 14px;">
                        ğŸ” ìµœì í™” ë¶„ì„
                    </button>
                </div>
                
                <!-- ì•„ì´í…œë³„ íš¨ìœ¨ì„± -->
                <div>
                    <h3 id="sidebar-title" style="margin-bottom: 15px;">ğŸ“Š ì•„ì´í…œë³„ íš¨ìœ¨ì„±</h3>
                    <div id="efficiency-list">
                        <div style="text-align: center; color: #888; padding: 20px; font-size: 12px;">
                            ì‹œì„¸ë¥¼ ì…ë ¥í•˜ë©´<br>íš¨ìœ¨ì„±ì´ í‘œì‹œë©ë‹ˆë‹¤
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="main-content">
            <!-- ì„¤ëª… ì„¹ì…˜ -->
            <div class="step-container">
                <div class="step-header">
                    <div class="step-number">ğŸ“Š</div>
                    <div class="step-title">ì•Œë¹„ì˜¨ ëª…í’ˆ ë¬´ì—­ ìµœì í™”</div>
                </div>
                <div class="step-content">
                    <div style="text-align: center; color: #666;">
                        <p style="margin-bottom: 15px;">ì˜¤ë¥¸ìª½ ì‚¬ì´ë“œë°”ì—ì„œ ì‹œì„¸ì™€ íˆ¬ìê¸ˆì•¡ì„ ì…ë ¥í•˜ë©´</p>
                        <p style="margin-bottom: 15px;">ì‹¤ì‹œê°„ìœ¼ë¡œ ìµœì í™” ê²°ê³¼ê°€ ì—…ë°ì´íŠ¸ë©ë‹ˆë‹¤</p>
                        <div style="margin-top: 20px; font-size: 14px; background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <div style="margin-bottom: 8px;">ğŸ’° <strong>ìˆ˜ìµë¥  ìµœëŒ€í™”:</strong> ì„¤ì • íˆ¬ìê¸ˆì•¡ ë‚´ì—ì„œ ìµœê³  ìˆ˜ìµë¥ </div>
                            <div>âš¡ <strong>íš¨ìœ¨ì„± ìµœëŒ€í™”:</strong> ê°€ì¥ ì ì€ íˆ¬ìë¡œ ìµœëŒ€ ìˆ˜ìµ</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ìµœì í™” ê²°ê³¼ -->
            <div class="step-container hidden" id="results-container">
                <div class="step-header">
                    <div class="step-number">ğŸ†</div>
                    <div class="step-title">ìµœì í™” ê²°ê³¼</div>
                </div>
                <div class="step-content">
                    <div class="results-section">
                        <div class="optimal-result">
                            <h3>âš¡ íš¨ìœ¨ì„± ìµœëŒ€í™”</h3>
                            <div id="efficiency-details"></div>
                        </div>
                        <div class="calculation-result">
                            <h3>ğŸ’° ìˆ˜ìµë¥  ìµœëŒ€í™”</h3>
                            <div id="profit-details"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ê³ ì •ë¹„ ì„¤ì • -->
            <div class="step-container">
                <div class="step-header">
                    <div class="step-number">ğŸ‚</div>
                    <div class="step-title">ê³ ì •ë¹„ ì„¤ì •</div>
                    <button onclick="toggleSettings()" id="settings-btn" style="margin-left: auto; padding: 8px 20px; border: 2px solid #667eea; background: white; color: #667eea; border-radius: 25px; cursor: pointer; font-weight: 600; transition: all 0.3s ease;" onmouseover="this.style.background='#667eea'; this.style.color='white'" onmouseout="this.style.background='white'; this.style.color='#667eea'">ê°€ê²© ì„¤ì • ë° ì •ë³´ ë³´ê¸°</button>
                </div>
                <div class="step-content hidden" id="settings-panel" style="transition: all 0.3s ease;">
                    <div style="text-align: center; margin-bottom: 20px; color: #666;">
                        <p>íƒˆê²ƒê³¼ íŒŒì´ì˜ ê°€ê²©ì„ ì„¤ì •í•˜ì„¸ìš” (ë¹ˆ ê°’ì€ ê¸°ë³¸ê°’ ì‚¬ìš©)</p>
                    </div>
                    
                    <!-- íƒˆê²ƒ ë° íŒŒì´ ê°€ê²© ì„¤ì • -->
                    <div style="background: white; padding: 20px; border-radius: 12px; border: 2px solid #e9ecef; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h4 style="margin: 0; color: #333;">ğŸ‚ í™©ì†Œ ë° íŒŒì´ ê°€ê²© ì„¤ì •</h4>
                            <button id="fetch-mount-btn" onclick="fetchMountAndPiePrices()" style="padding: 6px 12px; border: 1px solid #667eea; background: white; color: #667eea; border-radius: 15px; cursor: pointer; font-size: 11px; font-weight: 600;" onmouseover="this.style.background='#667eea'; this.style.color='white'" onmouseout="this.style.background='white'; this.style.color='#667eea'">ğŸ”„ ì‹¤ì‹œê°„</button>
                        </div>
                        
                        <!-- í™©ì†Œ ì„¤ì • -->
                        <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 15px; margin-bottom: 30px;">
                            <!-- 3í‹°ì–´ -->
                            <div style="text-align: center;">
                                <h5 style="color: #667eea; font-weight: 600; margin-bottom: 10px;">3í‹°ì–´</h5>
                                <div style="display: grid; gap: 8px;">
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">ì¼ë°˜ (1,058kg)</div>
                                        <input type="text" id="ox3_normal_price" value="13,000" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox3_normal', this.value)">
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">ì¢‹ìŒ (1,120kg)</div>
                                        <input type="text" id="ox3_good_price" value="13,000" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox3_good', this.value)">
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">ë›°ì–´ë‚¨ (1,184kg)</div>
                                        <input type="text" id="ox3_outstanding_price" value="13,000" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox3_outstanding', this.value)">
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">ìš°ìˆ˜í•¨ (1,251kg)</div>
                                        <input type="text" id="ox3_excellent_price" value="15,000" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox3_excellent', this.value)">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 4í‹°ì–´ -->
                            <div style="text-align: center;">
                                <h5 style="color: #667eea; font-weight: 600; margin-bottom: 10px;">4í‹°ì–´</h5>
                                <div style="display: grid; gap: 8px;">
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">ì¼ë°˜ (1,165kg)</div>
                                        <input type="text" id="ox4_normal_price" value="35,739" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox4_normal', this.value)">
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">ì¢‹ìŒ (1,228kg)</div>
                                        <input type="text" id="ox4_good_price" value="35,739" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox4_good', this.value)">
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">ë›°ì–´ë‚¨ (1,294kg)</div>
                                        <input type="text" id="ox4_outstanding_price" value="42,572" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox4_outstanding', this.value)">
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">ìš°ìˆ˜í•¨ (1,362kg)</div>
                                        <input type="text" id="ox4_excellent_price" value="50,754" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox4_excellent', this.value)">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 5í‹°ì–´ -->
                            <div style="text-align: center;">
                                <h5 style="color: #667eea; font-weight: 600; margin-bottom: 10px;">5í‹°ì–´</h5>
                                <div style="display: grid; gap: 8px;">
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">ì¼ë°˜ (1,338kg)</div>
                                        <input type="text" id="ox5_normal_price" value="85,633" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox5_normal', this.value)">
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">ì¢‹ìŒ (1,406kg)</div>
                                        <input type="text" id="ox5_good_price" value="85,633" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox5_good', this.value)">
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">ë›°ì–´ë‚¨ (1,447kg)</div>
                                        <input type="text" id="ox5_outstanding_price" value="95,667" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox5_outstanding', this.value)">
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">ìš°ìˆ˜í•¨ (1,551kg)</div>
                                        <input type="text" id="ox5_excellent_price" value="109,414" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox5_excellent', this.value)">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 6í‹°ì–´ -->
                            <div style="text-align: center;">
                                <h5 style="color: #667eea; font-weight: 600; margin-bottom: 10px;">6í‹°ì–´</h5>
                                <div style="display: grid; gap: 8px;">
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">ì¼ë°˜ (1,574kg)</div>
                                        <input type="text" id="ox6_normal_price" value="217,818" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox6_normal', this.value)">
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">ì¢‹ìŒ (1,651kg)</div>
                                        <input type="text" id="ox6_good_price" value="217,818" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox6_good', this.value)">
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">ë›°ì–´ë‚¨ (1,730kg)</div>
                                        <input type="text" id="ox6_outstanding_price" value="238,917" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox6_outstanding', this.value)">
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">ìš°ìˆ˜í•¨ (1,813kg)</div>
                                        <input type="text" id="ox6_excellent_price" value="264,648" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox6_excellent', this.value)">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 7í‹°ì–´ -->
                            <div style="text-align: center;">
                                <h5 style="color: #667eea; font-weight: 600; margin-bottom: 10px;">7í‹°ì–´</h5>
                                <div style="display: grid; gap: 8px;">
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">ì¼ë°˜ (1,876kg)</div>
                                        <input type="text" id="ox7_normal_price" value="570,169" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox7_normal', this.value)">
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">ì¢‹ìŒ (1,964kg)</div>
                                        <input type="text" id="ox7_good_price" value="570,169" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox7_good', this.value)">
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">ë›°ì–´ë‚¨ (2,056kg)</div>
                                        <input type="text" id="ox7_outstanding_price" value="569,961" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox7_outstanding', this.value)">
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">ìš°ìˆ˜í•¨ (2,152kg)</div>
                                        <input type="text" id="ox7_excellent_price" value="628,990" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox7_excellent', this.value)">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 8í‹°ì–´ -->
                            <div style="text-align: center;">
                                <h5 style="color: #667eea; font-weight: 600; margin-bottom: 10px;">8í‹°ì–´</h5>
                                <div style="display: grid; gap: 8px;">
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">ì¼ë°˜ (2,252kg)</div>
                                        <input type="text" id="ox8_normal_price" value="1,659,956" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox8_normal', this.value)">
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">ì¢‹ìŒ (2,355kg)</div>
                                        <input type="text" id="ox8_good_price" value="1,659,956" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox8_good', this.value)">
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">ë›°ì–´ë‚¨ (2,462kg)</div>
                                        <input type="text" id="ox8_outstanding_price" value="1,677,557" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox8_outstanding', this.value)">
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">ìš°ìˆ˜í•¨ (2,573kg)</div>
                                        <input type="text" id="ox8_excellent_price" value="1,742,522" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox8_excellent', this.value)">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- íŒŒì´ ì„¤ì • -->
                        <div style="border-top: 1px solid #e9ecef; padding-top: 20px;">
                            <h5 style="color: #667eea; font-weight: 600; margin-bottom: 15px; text-align: center;">ğŸ¥§ íŒŒì´ ë²„í”„</h5>
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                                <div style="text-align: center;">
                                    <div style="font-size: 12px; color: #666; margin-bottom: 5px;">3T ì¹˜í‚¨ (10% ë²„í”„)</div>
                                    <input type="text" id="chicken_pie_price" value="481" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px; font-size: 12px; text-align: center;" oninput="formatPiePrice('chicken', this.value)">
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 12px; color: #666; margin-bottom: 5px;">5T ê±°ìœ„ (20% ë²„í”„)</div>
                                    <input type="text" id="goose_pie_price" value="2,459" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px; font-size: 12px; text-align: center;" oninput="formatPiePrice('goose', this.value)">
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 12px; color: #666; margin-bottom: 5px;">7T ë¼ì§€ (30% ë²„í”„)</div>
                                    <input type="text" id="pork_pie_price" value="5,115" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px; font-size: 12px; text-align: center;" oninput="formatPiePrice('pork', this.value)">
                                </div>
                            </div>
                        </div>
                    </div>
                    

                    <div style="text-align: center;">
                        <button onclick="resetMountPrices()" style="padding: 10px 25px; border: 2px solid #dc3545; background: white; color: #dc3545; border-radius: 25px; cursor: pointer; font-weight: 600; margin-right: 10px;">ê¸°ë³¸ê°’ìœ¼ë¡œ ì´ˆê¸°í™”</button>
                        <button onclick="toggleSettings()" style="padding: 10px 25px; border: 2px solid #28a745; background: white; color: #28a745; border-radius: 25px; cursor: pointer; font-weight: 600;">ì„¤ì • ì™„ë£Œ</button>
                    </div>
                </div>
            </div>
            </div> <!-- main-content ë‹«ê¸° -->
        </div>
    </div>

    <script>
        let currentRate = 96;
        let isLoadingPrices = false;
        
        // API ì„¤ì •
        const API_BASE = 'https://east.albion-online-data.com/api/v2/stats/prices';
        const TREASURE_ITEMS = 'TREASURE_RITUAL_RARITY1,TREASURE_RITUAL_RARITY2,TREASURE_RITUAL_RARITY3';
        const MOUNT_ITEMS = 'T3_MOUNT_OX,T4_MOUNT_OX,T5_MOUNT_OX,T6_MOUNT_OX,T7_MOUNT_OX,T8_MOUNT_OX';
        const PIE_ITEMS = 'T3_MEAL_PIE,T5_MEAL_PIE@1,T7_MEAL_PIE';
        const FORT_STERLING = 'Fort Sterling';
        const CAERLEON = 'Caerleon';

        const items = [
            { sellPrice: 5000, weight: 5, name: '5kg ì•„ì´í…œ' },
            { sellPrice: 1000, weight: 2.5, name: '2.5kg ì•„ì´í…œ' },
            { sellPrice: 25000, weight: 6.3, name: '6.3kg ì•„ì´í…œ' }
        ];

        const defaultMountPrices = {
            ox3_normal: 13000, ox3_good: 13000, ox3_outstanding: 13000, ox3_excellent: 15000,
            ox4_normal: 35739, ox4_good: 35739, ox4_outstanding: 42572, ox4_excellent: 50754,
            ox5_normal: 85633, ox5_good: 85633, ox5_outstanding: 95667, ox5_excellent: 109414,
            ox6_normal: 217818, ox6_good: 217818, ox6_outstanding: 238917, ox6_excellent: 264648,
            ox7_normal: 570169, ox7_good: 570169, ox7_outstanding: 569961, ox7_excellent: 628990,
            ox8_normal: 1659956, ox8_good: 1659956, ox8_outstanding: 1677557, ox8_excellent: 1742522
        };

        const defaultPiePrices = {
            chicken: 481, goose: 2459, pork: 5115
        };

        const mounts = {
            ox3_normal: { capacity: 1058, price: 13000, name: '3í‹°ì–´ í™©ì†Œ ì¼ë°˜' },
            ox3_good: { capacity: 1120, price: 13000, name: '3í‹°ì–´ í™©ì†Œ ì¢‹ìŒ' },
            ox3_outstanding: { capacity: 1184, price: 13000, name: '3í‹°ì–´ í™©ì†Œ ë›°ì–´ë‚¨' },
            ox3_excellent: { capacity: 1251, price: 15000, name: '3í‹°ì–´ í™©ì†Œ ìš°ìˆ˜í•¨' },
            
            ox4_normal: { capacity: 1165, price: 35739, name: '4í‹°ì–´ í™©ì†Œ ì¼ë°˜' },
            ox4_good: { capacity: 1228, price: 35739, name: '4í‹°ì–´ í™©ì†Œ ì¢‹ìŒ' },
            ox4_outstanding: { capacity: 1294, price: 42572, name: '4í‹°ì–´ í™©ì†Œ ë›°ì–´ë‚¨' },
            ox4_excellent: { capacity: 1362, price: 50754, name: '4í‹°ì–´ í™©ì†Œ ìš°ìˆ˜í•¨' },
            
            ox5_normal: { capacity: 1338, price: 85633, name: '5í‹°ì–´ í™©ì†Œ ì¼ë°˜' },
            ox5_good: { capacity: 1406, price: 85633, name: '5í‹°ì–´ í™©ì†Œ ì¢‹ìŒ' },
            ox5_outstanding: { capacity: 1447, price: 95667, name: '5í‹°ì–´ í™©ì†Œ ë›°ì–´ë‚¨' },
            ox5_excellent: { capacity: 1551, price: 109414, name: '5í‹°ì–´ í™©ì†Œ ìš°ìˆ˜í•¨' },
            
            ox6_normal: { capacity: 1574, price: 217818, name: '6í‹°ì–´ í™©ì†Œ ì¼ë°˜' },
            ox6_good: { capacity: 1651, price: 217818, name: '6í‹°ì–´ í™©ì†Œ ì¢‹ìŒ' },
            ox6_outstanding: { capacity: 1730, price: 238917, name: '6í‹°ì–´ í™©ì†Œ ë›°ì–´ë‚¨' },
            ox6_excellent: { capacity: 1813, price: 264648, name: '6í‹°ì–´ í™©ì†Œ ìš°ìˆ˜í•¨' },
            
            ox7_normal: { capacity: 1876, price: 570169, name: '7í‹°ì–´ í™©ì†Œ ì¼ë°˜' },
            ox7_good: { capacity: 1964, price: 570169, name: '7í‹°ì–´ í™©ì†Œ ì¢‹ìŒ' },
            ox7_outstanding: { capacity: 2056, price: 569961, name: '7í‹°ì–´ í™©ì†Œ ë›°ì–´ë‚¨' },
            ox7_excellent: { capacity: 2152, price: 628990, name: '7í‹°ì–´ í™©ì†Œ ìš°ìˆ˜í•¨' },
            
            ox8_normal: { capacity: 2252, price: 1659956, name: '8í‹°ì–´ í™©ì†Œ ì¼ë°˜' },
            ox8_good: { capacity: 2355, price: 1659956, name: '8í‹°ì–´ í™©ì†Œ ì¢‹ìŒ' },
            ox8_outstanding: { capacity: 2462, price: 1677557, name: '8í‹°ì–´ í™©ì†Œ ë›°ì–´ë‚¨' },
            ox8_excellent: { capacity: 2573, price: 1742522, name: '8í‹°ì–´ í™©ì†Œ ìš°ìˆ˜í•¨' }
        };

        const pies = {
            none: { buff: 0, price: 0, name: 'ì‚¬ìš© ì•ˆí•¨' },
            chicken: { buff: 10, price: 481, name: '3í‹°ì–´ ì¹˜í‚¨ íŒŒì´' },
            goose: { buff: 20, price: 2459, name: '5í‹°ì–´ ê±°ìœ„ íŒŒì´' },
            pork: { buff: 30, price: 5115, name: '7í‹°ì–´ ë¼ì§€ê³ ê¸° íŒŒì´' }
        };

        function setMode(rate) {
            currentRate = rate;
            
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            updateInputs();
        }

        function updateInputs() {
            const prices = [
                parseFloat(document.getElementById('price-0').value) || 0,
                parseFloat(document.getElementById('price-1').value) || 0,
                parseFloat(document.getElementById('price-2').value) || 0
            ];
            
            const investment = getInvestmentValue();
            
            const hasPrice = prices.some(price => price > 0);
            const hasInvestment = investment > 0;
            
            const optimizeBtn = document.getElementById('optimize-btn');
            optimizeBtn.disabled = !(hasPrice && hasInvestment);
            
            // ì•„ì´í…œë³„ íš¨ìœ¨ì„± ì—…ë°ì´íŠ¸
            updateItemEfficiencies(prices);
            
            // ê²°ê³¼ê°€ ì´ë¯¸ í‘œì‹œëœ ìƒíƒœë¼ë©´ ìë™ìœ¼ë¡œ ì—…ë°ì´íŠ¸
            const resultsContainer = document.getElementById('results-container');
            if (!resultsContainer.classList.contains('hidden') && hasPrice && hasInvestment) {
                findBothOptimalSettings();
            }
        }
        


        function findBothOptimalSettings() {
            const efficiencySetting = findOptimalSetting('efficiency');
            const profitSetting = findOptimalSetting('profit');
            
            if (efficiencySetting && profitSetting) {
                displayBothResults(efficiencySetting, profitSetting);
            } else {
                alert('ìµœì  ì„¸íŒ…ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤.');
            }
        }
        
        function findOptimalSetting(mode) {
            const investmentAmount = getInvestmentValue();
            const itemPrices = [
                parseFloat(document.getElementById('price-0').value) || 0,
                parseFloat(document.getElementById('price-1').value) || 0,
                parseFloat(document.getElementById('price-2').value) || 0
            ];
            
            let bestSetting = null;
            let bestScore = mode === 'efficiency' ? -Infinity : -Infinity;
            
            // ëª¨ë“  íƒˆê²ƒ/íŒŒì´ ì¡°í•© í…ŒìŠ¤íŠ¸
            Object.keys(mounts).forEach(mountKey => {
                Object.keys(pies).forEach(pieKey => {
                    const mount = mounts[mountKey];
                    const pie = pies[pieKey];
                    const actualCapacity = Math.floor(mount.capacity * (1 + pie.buff / 100));
                    const fixedCost = mount.price + pie.price;
                    
                    // ê° ì•„ì´í…œì— ëŒ€í•´ ìµœì  ìˆ˜ëŸ‰ ê³„ì‚°
                    items.forEach((item, itemIndex) => {
                        const itemPrice = itemPrices[itemIndex];
                        if (itemPrice <= 0) return;
                        
                        let maxQuantity, totalInvestment, availableForItems;
                        
                        // ë‘ ëª¨ë“œ ëª¨ë‘ íˆ¬ìê¸ˆì•¡ ë‚´ì—ì„œ ê³„ì‚°
                        if (fixedCost >= investmentAmount) return;
                        availableForItems = investmentAmount - fixedCost;
                        const maxByMoney = Math.floor(availableForItems / itemPrice);
                        const maxByWeight = Math.floor(actualCapacity / item.weight);
                        maxQuantity = Math.min(maxByMoney, maxByWeight);
                        totalInvestment = fixedCost + (maxQuantity * itemPrice);
                        
                        if (maxQuantity <= 0) return;
                        
                        const totalItemCost = maxQuantity * itemPrice;
                        const revenue = maxQuantity * item.sellPrice * (currentRate / 100);
                        const profit = revenue - totalItemCost - fixedCost;
                        
                        let score;
                        if (mode === 'efficiency') {
                            // íš¨ìœ¨ì„±: ì‹¤ì œ íˆ¬ì ëŒ€ë¹„ ìˆ˜ìµ ë¹„ìœ¨ (ì ì€ íˆ¬ìë¡œ ë†’ì€ ìˆ˜ìµ)
                            score = totalInvestment > 0 ? profit / totalInvestment : 0;
                        } else {
                            // ìˆ˜ìµë¥ : ì„¤ì •ëœ íˆ¬ìê¸ˆì•¡ ëŒ€ë¹„ ìˆ˜ìµë¥ 
                            score = (profit / investmentAmount) * 100;
                        }
                        
                        if (score > bestScore) {
                            bestScore = score;
                            bestSetting = {
                                mode, mountKey, pieKey, itemIndex, quantity: maxQuantity,
                                mount, pie, item, actualCapacity, fixedCost,
                                totalItemCost, revenue, profit, 
                                totalInvestment: totalInvestment,
                                efficiency: (profit / totalInvestment) * 100,
                                itemPrice, score
                            };
                        }
                    });
                });
            });
            
            return bestSetting;
        }

        function displayBothResults(efficiencySetting, profitSetting) {
            const t = translations[currentLanguage];
            const isKo = currentLanguage === 'ko';
            
            // ê²°ê³¼ ì œëª© ì—…ë°ì´íŠ¸
            document.querySelector('.optimal-result h3').textContent = t.efficiencyTitle;
            document.querySelector('.calculation-result h3').textContent = t.profitTitle;
            
            // íš¨ìœ¨ì„± ìµœëŒ€í™” ê²°ê³¼
            document.getElementById('efficiency-details').innerHTML = `
                <div style="text-align: center; margin-bottom: 15px; font-size: 14px; opacity: 0.8;">
                    ${isKo ? 'ê°€ì¥ ì ì€ íˆ¬ìë¡œ ìµœëŒ€ ìˆ˜ìµ' : 'Maximum profit with minimal investment'}
                </div>
                <div class="optimal-details">
                    <strong>${isKo ? 'ğŸ‚ íƒˆê²ƒ:' : 'ğŸ‚ Mount:'}</strong> ${isKo ? efficiencySetting.mount.name : efficiencySetting.mount.name.replace(/í‹°ì–´|í™©ì†Œ|ì¼ë°˜|ì¢‹ìŒ|ë›°ì–´ë‚¨|ìš°ìˆ˜í•¨/g, m => ({'í‹°ì–´':'T','í™©ì†Œ':'Ox','ì¼ë°˜':'Normal','ì¢‹ìŒ':'Good','ë›°ì–´ë‚¨':'Outstanding','ìš°ìˆ˜í•¨':'Excellent'}[m]))}<br>
                    <strong>${isKo ? 'ğŸ¥§ ë²„í”„:' : 'ğŸ¥§ Buff:'}</strong> ${isKo ? efficiencySetting.pie.name : efficiencySetting.pie.name.replace(/í‹°ì–´|ì¹˜í‚¨ íŒŒì´|ê±°ìœ„ íŒŒì´|ë¼ì§€ê³ ê¸° íŒŒì´|ì‚¬ìš© ì•ˆí•¨/g, m => ({'í‹°ì–´':'T','ì¹˜í‚¨ íŒŒì´':'Chicken Pie','ê±°ìœ„ íŒŒì´':'Goose Pie','ë¼ì§€ê³ ê¸° íŒŒì´':'Pork Pie','ì‚¬ìš© ì•ˆí•¨':'None'}[m]))}<br>
                    <strong>${isKo ? 'ğŸ“¦ ì•„ì´í…œ:' : 'ğŸ“¦ Item:'}</strong> ${isKo ? efficiencySetting.item.name : efficiencySetting.item.name.replace('ì•„ì´í…œ', 'Item')} Ã— ${efficiencySetting.quantity}${isKo ? 'ê°œ' : ' items'}<br>
                    <strong>${isKo ? 'ğŸ“ ìµœëŒ€ì ì¬ëŸ‰:' : 'ğŸ“ Max Capacity:'}</strong> ${efficiencySetting.actualCapacity}kg
                </div>
                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.3);">
                    <div class="result-item" style="color: white; border: none; padding: 5px 0;">
                        <span>${isKo ? 'ğŸ’° íˆ¬ìê¸ˆ:' : 'ğŸ’° Investment:'}</span>
                        <span style="font-weight: bold;">${efficiencySetting.totalInvestment.toLocaleString()}${isKo ? 'ì‹¤ë²„' : ' Silver'}</span>
                    </div>
                    <div class="result-item" style="color: white; border: none; padding: 5px 0;">
                        <span>${isKo ? 'ğŸ“ˆ ìˆœì´ìµ:' : 'ğŸ“ˆ Net Profit:'}</span>
                        <span style="font-weight: bold;">${Math.round(efficiencySetting.profit).toLocaleString()}${isKo ? 'ì‹¤ë²„' : ' Silver'}</span>
                    </div>
                    <div class="result-item" style="color: white; border: none; padding: 5px 0;">
                        <span>${isKo ? 'ğŸ¯ ìˆ˜ìµë¥ :' : 'ğŸ¯ Profit Rate:'}</span>
                        <span style="font-weight: bold;">${efficiencySetting.efficiency.toFixed(1)}%</span>
                    </div>
                </div>
            `;
            
            // ìˆ˜ìµë¥  ìµœëŒ€í™” ê²°ê³¼
            document.getElementById('profit-details').innerHTML = `
                <div style="text-align: center; margin-bottom: 15px; font-size: 14px; color: #666;">
                    ${isKo ? 'ì„¤ì • íˆ¬ìê¸ˆì•¡ ëŒ€ë¹„ ìµœê³  ìˆ˜ìµë¥ ' : 'Highest profit rate within set investment'}
                </div>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <strong>${isKo ? 'ğŸ‚ íƒˆê²ƒ:' : 'ğŸ‚ Mount:'}</strong> ${isKo ? profitSetting.mount.name : profitSetting.mount.name.replace(/í‹°ì–´|í™©ì†Œ|ì¼ë°˜|ì¢‹ìŒ|ë›°ì–´ë‚¨|ìš°ìˆ˜í•¨/g, m => ({'í‹°ì–´':'T','í™©ì†Œ':'Ox','ì¼ë°˜':'Normal','ì¢‹ìŒ':'Good','ë›°ì–´ë‚¨':'Outstanding','ìš°ìˆ˜í•¨':'Excellent'}[m]))}<br>
                    <strong>${isKo ? 'ğŸ¥§ ë²„í”„:' : 'ğŸ¥§ Buff:'}</strong> ${isKo ? profitSetting.pie.name : profitSetting.pie.name.replace(/í‹°ì–´|ì¹˜í‚¨ íŒŒì´|ê±°ìœ„ íŒŒì´|ë¼ì§€ê³ ê¸° íŒŒì´|ì‚¬ìš© ì•ˆí•¨/g, m => ({'í‹°ì–´':'T','ì¹˜í‚¨ íŒŒì´':'Chicken Pie','ê±°ìœ„ íŒŒì´':'Goose Pie','ë¼ì§€ê³ ê¸° íŒŒì´':'Pork Pie','ì‚¬ìš© ì•ˆí•¨':'None'}[m]))}<br>
                    <strong>${isKo ? 'ğŸ“¦ ì•„ì´í…œ:' : 'ğŸ“¦ Item:'}</strong> ${isKo ? profitSetting.item.name : profitSetting.item.name.replace('ì•„ì´í…œ', 'Item')} Ã— ${profitSetting.quantity}${isKo ? 'ê°œ' : ' items'}<br>
                    <strong>${isKo ? 'ğŸ“ ìµœëŒ€ì ì¬ëŸ‰:' : 'ğŸ“ Max Capacity:'}</strong> ${profitSetting.actualCapacity}kg
                </div>
                <div class="result-item">
                    <span class="result-label">${isKo ? 'ğŸ’° íˆ¬ìê¸ˆ' : 'ğŸ’° Investment'}</span>
                    <span class="result-value">${profitSetting.totalInvestment.toLocaleString()}${isKo ? 'ì‹¤ë²„' : ' Silver'}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">${isKo ? 'ğŸ“ˆ ìˆœì´ìµ' : 'ğŸ“ˆ Net Profit'}</span>
                    <span class="result-value ${profitSetting.profit >= 0 ? 'profit-positive' : 'profit-negative'}">
                        ${Math.round(profitSetting.profit).toLocaleString()}${isKo ? 'ì‹¤ë²„' : ' Silver'}
                    </span>
                </div>
                <div class="result-item">
                    <span class="result-label">${isKo ? 'ğŸ¯ ìˆ˜ìµë¥ ' : 'ğŸ¯ Profit Rate'}</span>
                    <span class="result-value ${profitSetting.efficiency >= 0 ? 'profit-positive' : 'profit-negative'}">
                        ${profitSetting.efficiency.toFixed(1)}%
                    </span>
                </div>
            `;
            
            document.getElementById('results-container').classList.remove('hidden');
        }

        function formatInvestmentInput() {
            const input = document.getElementById('investment-amount');
            const cursorPosition = input.selectionStart;
            const oldValue = input.value;
            
            let value = input.value.replace(/,/g, '');
            if (value === '' || isNaN(value)) {
                updateInputs();
                return;
            }
            
            const newValue = parseInt(value).toLocaleString();
            input.value = newValue;
            
            // ì»¤ì„œ ìœ„ì¹˜ ì¡°ì • - ì½¤ë§ˆ ê°œìˆ˜ ë³€í™” ê³ ë ¤
            const oldCommas = (oldValue.match(/,/g) || []).length;
            const newCommas = (newValue.match(/,/g) || []).length;
            const commaDiff = newCommas - oldCommas;
            
            const newCursorPosition = Math.max(0, Math.min(newValue.length, cursorPosition + commaDiff));
            input.setSelectionRange(newCursorPosition, newCursorPosition);
            
            updateInputs();
        }

        function getInvestmentValue() {
            const value = document.getElementById('investment-amount').value.replace(/,/g, '');
            return parseFloat(value) || 0;
        }

        let currentLanguage = 'ko';
        
        const translations = {
            ko: {
                contractMode: 'êµ¬ë§¤ê³„ì•½ì„œ (93.5%)',
                normalMode: 'ì¼ë°˜ ê±°ë˜ (96%)',
                optimizeBtn: 'ğŸ” ìµœì í™” ë¶„ì„',
                efficiencyTitle: 'âš¡ íš¨ìœ¨ì„± ìµœëŒ€í™”',
                profitTitle: 'ğŸ’° ìˆ˜ìµë¥  ìµœëŒ€í™”',
                settingsOpen: 'ê°€ê²© ì„¤ì • ë° ì •ë³´ ë³´ê¸°',
                settingsClose: 'ê°€ê²© ì„¤ì • ë° ì •ë³´ ë‹«ê¸°',
                efficiencyTitle: 'ğŸ“Š ì•„ì´í…œë³„ íš¨ìœ¨ì„±'
            },
            en: {
                contractMode: 'Purchase Contract (93.5%)',
                normalMode: 'Normal Trade (96%)',
                optimizeBtn: 'ğŸ” Analyze Optimal Settings',
                efficiencyTitle: 'âš¡ Efficiency Maximization',
                profitTitle: 'ğŸ’° Profit Maximization',
                settingsOpen: 'Price Settings & Info',
                settingsClose: 'Close Settings & Info',
                efficiencyTitle: 'ğŸ“Š Item Efficiency'
            }
        };
        
        function setLanguage(lang) {
            currentLanguage = lang;
            const t = translations[lang];
            
            // ëª¨ë“œ ë²„íŠ¼
            const modeBtns = document.querySelectorAll('.mode-btn');
            if (modeBtns[0]) modeBtns[0].textContent = t.contractMode;
            if (modeBtns[1]) modeBtns[1].textContent = t.normalMode;
            
            // ìµœì í™” ë²„íŠ¼
            const optimizeBtn = document.getElementById('optimize-btn');
            if (optimizeBtn) optimizeBtn.textContent = t.optimizeBtn;
            
            // ì„¤ì • ë²„íŠ¼
            const settingsPanel = document.getElementById('settings-panel');
            const settingsBtn = document.getElementById('settings-btn');
            if (settingsBtn && settingsPanel) {
                settingsBtn.textContent = settingsPanel.classList.contains('hidden') ? t.settingsOpen : t.settingsClose;
            }
            
            // ì‚¬ì´ë“œë°” ì œëª©
            const sidebarTitle = document.getElementById('sidebar-title');
            if (sidebarTitle) sidebarTitle.textContent = t.efficiencyTitle;
            
            // ì–¸ì–´ ë²„íŠ¼ ìŠ¤íƒ€ì¼
            const langKo = document.getElementById('lang-ko');
            const langEn = document.getElementById('lang-en');
            
            langKo.style.background = lang === 'ko' ? 'white' : 'transparent';
            langKo.style.color = lang === 'ko' ? '#667eea' : 'white';
            langKo.style.borderColor = lang === 'ko' ? 'white' : 'rgba(255,255,255,0.5)';
            
            langEn.style.background = lang === 'en' ? 'white' : 'transparent';
            langEn.style.color = lang === 'en' ? '#667eea' : 'white';
            langEn.style.borderColor = lang === 'en' ? 'white' : 'rgba(255,255,255,0.5)';
            
            updateInputs();
        }
        
        function toggleSettings() {
            const panel = document.getElementById('settings-panel');
            const btn = document.getElementById('settings-btn');
            const t = translations[currentLanguage];
            
            panel.classList.toggle('hidden');
            btn.textContent = panel.classList.contains('hidden') ? t.settingsOpen : t.settingsClose;
        }
        function formatMountPrice(mountKey, value) {
            const input = document.getElementById(mountKey + '_price');
            const cursorPosition = input.selectionStart;
            const oldValue = input.value;
            
            let cleanValue = value.replace(/,/g, '');
            if (cleanValue === '' || isNaN(cleanValue)) {
                mounts[mountKey].price = defaultMountPrices[mountKey];
                return;
            }
            
            const numericValue = parseInt(cleanValue);
            const formattedValue = numericValue.toLocaleString();
            input.value = formattedValue;
            
            // ì»¤ì„œ ìœ„ì¹˜ ì¡°ì •
            const oldCommas = (oldValue.match(/,/g) || []).length;
            const newCommas = (formattedValue.match(/,/g) || []).length;
            const commaDiff = newCommas - oldCommas;
            const newCursorPosition = Math.max(0, Math.min(formattedValue.length, cursorPosition + commaDiff));
            input.setSelectionRange(newCursorPosition, newCursorPosition);
            
            mounts[mountKey].price = numericValue;
        }

        function formatPiePrice(pieKey, value) {
            const input = document.getElementById(pieKey + '_pie_price');
            const cursorPosition = input.selectionStart;
            const oldValue = input.value;
            
            let cleanValue = value.replace(/,/g, '');
            if (cleanValue === '' || isNaN(cleanValue)) {
                pies[pieKey].price = defaultPiePrices[pieKey];
                return;
            }
            
            const numericValue = parseInt(cleanValue);
            const formattedValue = numericValue.toLocaleString();
            input.value = formattedValue;
            
            // ì»¤ì„œ ìœ„ì¹˜ ì¡°ì •
            const oldCommas = (oldValue.match(/,/g) || []).length;
            const newCommas = (formattedValue.match(/,/g) || []).length;
            const commaDiff = newCommas - oldCommas;
            const newCursorPosition = Math.max(0, Math.min(formattedValue.length, cursorPosition + commaDiff));
            input.setSelectionRange(newCursorPosition, newCursorPosition);
            
            pies[pieKey].price = numericValue;
        }

        // APIì—ì„œ ê°€ê²© ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        async function fetchPrices() {
            if (isLoadingPrices) return;
            isLoadingPrices = true;
            
            const btn = document.getElementById('fetch-btn');
            btn.textContent = 'â³ ë¡œë”©ì¤‘...';
            btn.disabled = true;
            
            try {
                // ëª…í’ˆ ì•„ì´í…œ ê°€ê²© (í¬íŠ¸ ìŠ¤í…”ë§ì—ì„œ êµ¬ë§¤)
                const treasureResponse = await fetch(`${API_BASE}/${TREASURE_ITEMS}.json?locations=${FORT_STERLING}&qualities=1`);
                const treasureData = await treasureResponse.json();
                
                // ë°ì´í„° ì—…ë°ì´íŠ¸
                updateTreasurePrices(treasureData);
                
                // ì…ë ¥ í•„ë“œ ì—…ë°ì´íŠ¸
                updateInputs();
                
                // ì„±ê³µ ë©”ì‹œì§€
                btn.textContent = 'âœ“ ì—…ë°ì´íŠ¸ ì™„ë£Œ';
                btn.style.background = '#28a745';
                btn.style.color = 'white';
                btn.style.borderColor = '#28a745';
                
                setTimeout(() => {
                    btn.textContent = 'ğŸ”„ ì‹¤ì‹œê°„';
                    btn.style.background = 'white';
                    btn.style.color = '#667eea';
                    btn.style.borderColor = '#667eea';
                }, 2000);
                
            } catch (error) {
                console.error('ê°€ê²© ë°ì´í„° ë¡œë“œ ì‹¤íŒ¨:', error);
                
                // ì‹¤íŒ¨ ë©”ì‹œì§€
                btn.textContent = 'âŒ ì—°ê²° ì‹¤íŒ¨';
                btn.style.background = '#dc3545';
                btn.style.color = 'white';
                btn.style.borderColor = '#dc3545';
                
                setTimeout(() => {
                    btn.textContent = 'ğŸ”„ ì‹¤ì‹œê°„';
                    btn.style.background = 'white';
                    btn.style.color = '#667eea';
                    btn.style.borderColor = '#667eea';
                }, 3000);
                
            } finally {
                isLoadingPrices = false;
                btn.disabled = false;
            }
        }
        
        function updateTreasurePrices(data) {
            const priceMap = {
                'TREASURE_RITUAL_RARITY2': 'price-0',
                'TREASURE_RITUAL_RARITY1': 'price-1',
                'TREASURE_RITUAL_RARITY3': 'price-2'
            };
            
            data.forEach(item => {
                const inputId = priceMap[item.item_id];
                if (inputId && item.sell_price_min > 0) {
                    document.getElementById(inputId).value = item.sell_price_min;
                }
            });
        }
        
        function resetMountPrices() {
            Object.keys(defaultMountPrices).forEach(key => {
                mounts[key].price = defaultMountPrices[key];
                const input = document.getElementById(key + '_price');
                if (input) input.value = defaultMountPrices[key].toLocaleString();
            });
            Object.keys(defaultPiePrices).forEach(key => {
                pies[key].price = defaultPiePrices[key];
                const input = document.getElementById(key + '_pie_price');
                if (input) input.value = defaultPiePrices[key].toLocaleString();
            });
        }

        function updateItemEfficiencies(prices) {
            const efficiencyList = document.getElementById('efficiency-list');
            const t = translations[currentLanguage];
            const isKo = currentLanguage === 'ko';
            
            if (!prices.some(p => p > 0)) {
                efficiencyList.innerHTML = `
                    <div style="text-align: center; color: #888; padding: 20px;">
                        ${isKo ? 'ì•„ì´í…œ ê°€ê²©ì„ ì…ë ¥í•˜ë©´<br>íš¨ìœ¨ì„±ì´ í‘œì‹œë©ë‹ˆë‹¤' : 'Enter item prices to see<br>efficiency comparison'}
                    </div>
                `;
                return;
            }
            
            const efficiencies = [];
            
            items.forEach((item, index) => {
                const itemPrice = prices[index];
                if (itemPrice <= 0) return;
                
                const revenue = item.sellPrice * (currentRate / 100);
                const profit = revenue - itemPrice;
                const profitPerKg = profit / item.weight;
                const profitPerSilver = profit / itemPrice;
                
                efficiencies.push({
                    item,
                    itemPrice,
                    profit,
                    profitPerKg,
                    profitPerSilver,
                    index
                });
            });
            
            // kgë‹¹ ìˆ˜ìµìœ¼ë¡œ ì •ë ¬
            efficiencies.sort((a, b) => b.profitPerKg - a.profitPerKg);
            
            let html = '';
            efficiencies.forEach((eff, rank) => {
                const isBest = rank === 0;
                const itemName = isKo ? eff.item.name : eff.item.name.replace('ì•„ì´í…œ', 'Item');
                
                html += `
                    <div class="efficiency-item ${isBest ? 'best' : ''}">
                        <h4>${isBest ? 'ğŸ† ' : ''}${itemName}</h4>
                        <div class="efficiency-stats">
                            <span>${isKo ? 'kgë‹¹ ìˆ˜ìµ:' : 'Profit/kg:'}</span>
                            <span class="efficiency-value ${isBest ? 'best' : ''}">${Math.round(eff.profitPerKg).toLocaleString()}</span>
                        </div>
                        <div class="efficiency-stats">
                            <span>${isKo ? 'ì‹¤ë²„ë‹¹ ìˆ˜ìµ:' : 'Profit/Silver:'}</span>
                            <span class="efficiency-value ${isBest ? 'best' : ''}">${(eff.profitPerSilver * 100).toFixed(1)}%</span>
                        </div>
                        <div class="efficiency-stats">
                            <span>${isKo ? 'ê°€ê²©:' : 'Price:'}</span>
                            <span>${eff.itemPrice.toLocaleString()}${isKo ? 'ì‹¤ë²„' : ' Silver'}</span>
                        </div>
                    </div>
                `;
            });
            
            efficiencyList.innerHTML = html;
        }
        
        async function fetchMountAndPiePrices() {
            const fetchBtn = document.getElementById('fetch-mount-btn');
            const originalText = fetchBtn.innerHTML;
            fetchBtn.innerHTML = 'â³ ë¡œë”©...';
            fetchBtn.disabled = true;
            
            try {
                // íƒˆê²ƒ ê°€ê²© ê°€ì ¸ì˜¤ê¸° (í¬íŠ¸ ìŠ¤í…”ë§ì—ì„œ êµ¬ë§¤ê°€)
                const mountResponse = await fetch(`${API_BASE}/${MOUNT_ITEMS}?locations=${FORT_STERLING}&qualities=1,2,3,4`);
                const mountData = await mountResponse.json();
                
                // íŒŒì´ ê°€ê²© ê°€ì ¸ì˜¤ê¸° (í¬íŠ¸ ìŠ¤í…”ë§ì—ì„œ êµ¬ë§¤ê°€)
                const pieResponse = await fetch(`${API_BASE}/${PIE_ITEMS}?locations=${FORT_STERLING}`);
                const pieData = await pieResponse.json();
                
                // íƒˆê²ƒ ê°€ê²© ì—…ë°ì´íŠ¸
                const mountMapping = {
                    'T3_MOUNT_OX': ['ox3_normal', 'ox3_good', 'ox3_outstanding', 'ox3_excellent'],
                    'T4_MOUNT_OX': ['ox4_normal', 'ox4_good', 'ox4_outstanding', 'ox4_excellent'],
                    'T5_MOUNT_OX': ['ox5_normal', 'ox5_good', 'ox5_outstanding', 'ox5_excellent'],
                    'T6_MOUNT_OX': ['ox6_normal', 'ox6_good', 'ox6_outstanding', 'ox6_excellent'],
                    'T7_MOUNT_OX': ['ox7_normal', 'ox7_good', 'ox7_outstanding', 'ox7_excellent'],
                    'T8_MOUNT_OX': ['ox8_normal', 'ox8_good', 'ox8_outstanding', 'ox8_excellent']
                };
                
                Object.entries(mountMapping).forEach(([itemId, qualities]) => {
                    qualities.forEach((qualityId, index) => {
                        const quality = index + 1;
                        const itemData = mountData.find(item => 
                            item.item_id === itemId && 
                            item.city === FORT_STERLING &&
                            item.quality === quality
                        );
                        
                        if (itemData && itemData.sell_price_min > 0) {
                            const input = document.getElementById(qualityId + '_price');
                            if (input) {
                                input.value = itemData.sell_price_min.toLocaleString();
                                mounts[qualityId].price = itemData.sell_price_min;
                            }
                        }
                    });
                });
                
                // íŒŒì´ ê°€ê²© ì—…ë°ì´íŠ¸
                const pieMapping = {
                    'T3_MEAL_PIE': 'chicken',
                    'T5_MEAL_PIE@1': 'goose',
                    'T7_MEAL_PIE': 'pork'
                };
                
                Object.entries(pieMapping).forEach(([itemId, pieType]) => {
                    const itemData = pieData.find(item => 
                        item.item_id === itemId && 
                        item.city === FORT_STERLING
                    );
                    
                    if (itemData && itemData.sell_price_min > 0) {
                        const input = document.getElementById(pieType + '_pie_price');
                        if (input) {
                            input.value = itemData.sell_price_min.toLocaleString();
                            pies[pieType].price = itemData.sell_price_min;
                        }
                    }
                });
                
                // ì„±ê³µ ë©”ì‹œì§€
                fetchBtn.innerHTML = 'âœ“ ì™„ë£Œ';
                fetchBtn.style.background = '#28a745';
                fetchBtn.style.color = 'white';
                
                setTimeout(() => {
                    fetchBtn.innerHTML = originalText;
                    fetchBtn.style.background = 'white';
                    fetchBtn.style.color = '#667eea';
                }, 2000);
                
            } catch (error) {
                console.error('íƒˆê²ƒ/íŒŒì´ ê°€ê²© ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤:', error);
                
                // ì‹¤íŒ¨ ë©”ì‹œì§€
                fetchBtn.innerHTML = 'âŒ ì‹¤íŒ¨';
                fetchBtn.style.background = '#dc3545';
                fetchBtn.style.color = 'white';
                
                setTimeout(() => {
                    fetchBtn.innerHTML = originalText;
                    fetchBtn.style.background = 'white';
                    fetchBtn.style.color = '#667eea';
                }, 3000);
                
            } finally {
                fetchBtn.disabled = false;
            }
        }

        // í˜ì´ì§€ ë¡œë“œì‹œ ì´ˆê¸° ì„¤ì •
        window.onload = function() {
            document.getElementById('investment-amount').value = '1,000,000';
            document.getElementById('price-0').value = 2500;
            document.getElementById('price-1').value = 500;
            document.getElementById('price-2').value = 12500;
            updateInputs();
            fetchPrices();
        };
    </script>
</body>
</html>
