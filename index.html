<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÏïåÎπÑÏò® Î™ÖÌíà Î¨¥Ïó≠ ÏµúÏ†ÅÌôî Í≥ÑÏÇ∞Í∏∞</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
        }
        
        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
            border-radius: 20px 20px 0 0;
        }
        
        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }
        
        .header p {
            opacity: 0.9;
            font-size: 16px;
        }
        
        .content {
            display: flex;
            gap: 20px;
            padding: 40px;
            align-items: flex-start;
        }
        
        .main-content {
            flex: 1;
            order: 1;
        }
        
        .sidebar {
            width: 350px;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            height: fit-content;
            position: sticky;
            top: 20px;
            align-self: flex-start;
            max-height: calc(100vh - 40px);
            overflow-y: auto;
            order: 2;
        }
        
        .sidebar h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
            text-align: center;
        }
        
        .efficiency-item {
            background: #f8f9fa;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 10px;
            border-left: 4px solid #667eea;
        }
        
        .efficiency-item.best {
            border-left-color: #28a745;
            background: #e8f5e8;
        }
        
        .efficiency-item h4 {
            margin: 0 0 8px 0;
            font-size: 14px;
            color: #333;
        }
        
        .efficiency-stats {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #666;
        }
        
        .efficiency-value {
            font-weight: bold;
            color: #667eea;
        }
        
        .efficiency-value.best {
            color: #28a745;
        }
        
        .step-container {
            margin-bottom: 40px;
        }
        
        .step-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #e9ecef;
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            margin-right: 15px;
        }
        
        .step-title {
            font-size: 20px;
            font-weight: 600;
            color: #333;
        }
        
        .step-content {
            background: #f8f9fa;
            padding: 25px;
            border-radius: 12px;
            border-left: 4px solid #667eea;
        }
        
        .price-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
        }
        
        .price-item {
            background: white;
            padding: 20px;
            border-radius: 10px;
            border: 2px solid #e9ecef;
            transition: all 0.3s ease;
        }
        
        .price-item:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.1);
        }
        
        .price-item h3 {
            color: #333;
            margin-bottom: 15px;
            font-size: 18px;
        }
        
        .price-input-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .price-input {
            flex: 1;
            padding: 12px 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: border-color 0.3s ease;
        }
        
        .price-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .investment-section {
            background: white;
            padding: 25px;
            border-radius: 12px;
            border: 2px solid #e9ecef;
            text-align: center;
        }
        
        .investment-input {
            width: 300px;
            padding: 15px 20px;
            border: 2px solid #ddd;
            border-radius: 10px;
            font-size: 18px;
            text-align: center;
            margin: 0 10px;
            transition: border-color 0.3s ease;
        }
        
        .investment-input:focus {
            outline: none;
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .optimize-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 15px 40px;
            border-radius: 10px;
            font-size: 18px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            transition: all 0.3s ease;
        }
        
        .optimize-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }
        
        .optimize-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }
        
        .results-section {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 30px;
            margin-top: 30px;
        }
        
        .optimal-result {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(79, 172, 254, 0.3);
        }
        
        .optimal-result h3 {
            margin-bottom: 20px;
            font-size: 20px;
        }
        
        .optimal-details {
            background: rgba(255,255,255,0.1);
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 15px;
        }
        
        .calculation-result {
            background: white;
            padding: 25px;
            border-radius: 15px;
            border: 2px solid #e9ecef;
        }
        
        .calculation-result h3 {
            color: #333;
            margin-bottom: 20px;
            font-size: 20px;
        }
        
        .result-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .result-item:last-child {
            border-bottom: none;
        }
        
        .result-label {
            font-weight: 600;
            color: #666;
        }
        
        .result-value {
            font-weight: bold;
            color: #333;
        }
        
        .profit-positive {
            color: #28a745;
        }
        
        .profit-negative {
            color: #dc3545;
        }
        
        .mode-toggle {
            text-align: center;
            margin-bottom: 20px;
        }
        
        .mode-btn {
            padding: 10px 20px;
            margin: 0 10px;
            border: 2px solid #667eea;
            border-radius: 25px;
            background: white;
            color: #667eea;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .mode-btn.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .hidden {
            display: none;
        }
        
        @media (max-width: 768px) {
            .content {
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                order: -1;
                position: relative;
                top: auto;
                max-height: none;
            }
            
            .results-section {
                grid-template-columns: 1fr;
            }
            
            .price-grid {
                grid-template-columns: 1fr;
            }
            
            .investment-input {
                width: 100%;
                max-width: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="main-container">
        <div class="header">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h1 id="main-title">üè™ ÏïåÎπÑÏò® Î™ÖÌíà Î¨¥Ïó≠ ÏµúÏ†ÅÌôî Í≥ÑÏÇ∞Í∏∞</h1>
                    <p id="main-subtitle">Îã®Í≥ÑÎ≥Ñ Í∞ÄÏù¥ÎìúÎ°ú ÏµúÏ†ÅÏùò Î¨¥Ïó≠ ÏàòÏùµÏùÑ Ï∞æÏïÑÎ≥¥ÏÑ∏Ïöî</p>
                </div>
                <div style="display: flex; gap: 10px;">
                    <button onclick="setLanguage('ko')" id="lang-ko" style="padding: 8px 12px; border: 2px solid white; background: white; color: #667eea; border-radius: 20px; cursor: pointer; font-weight: 600;">üá∞üá∑ ÌïúÍµ≠Ïñ¥</button>
                    <button onclick="setLanguage('en')" id="lang-en" style="padding: 8px 12px; border: 2px solid rgba(255,255,255,0.5); background: transparent; color: white; border-radius: 20px; cursor: pointer; font-weight: 600;">üá∫üá∏ English</button>
                </div>
            </div>
        </div>
        
        <div class="content">
            <!-- ÏÇ¨Ïù¥ÎìúÎ∞î: ÏûÖÎ†• Ìèº + Ìö®Ïú®ÏÑ± ÎπÑÍµê -->
            <div class="sidebar">
                <!-- Í±∞Îûò Î™®Îìú ÏÑ†ÌÉù -->
                <div style="margin-bottom: 20px;">
                    <h3 style="margin-bottom: 10px;">‚öôÔ∏è Í±∞Îûò Î™®Îìú</h3>
                    <div class="mode-toggle" style="margin-bottom: 0;">
                        <button class="mode-btn" onclick="setMode(93.5)" style="font-size: 12px; padding: 8px 12px;">Íµ¨Îß§Í≥ÑÏïΩÏÑú (93.5%)</button>
                        <button class="mode-btn active" onclick="setMode(96)" style="font-size: 12px; padding: 8px 12px;">ÏùºÎ∞òÍ±∞Îûò (96%)</button>
                    </div>
                </div>
                
                <!-- ÏïÑÏù¥ÌÖú ÏãúÏÑ∏ ÏûÖÎ†• -->
                <div style="margin-bottom: 25px;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                        <h3 style="margin: 0;">üí∞ ÏïÑÏù¥ÌÖú ÏãúÏÑ∏</h3>
                        <button id="fetch-btn" onclick="fetchPrices()" style="padding: 6px 12px; border: 1px solid #667eea; background: white; color: #667eea; border-radius: 15px; cursor: pointer; font-size: 11px; font-weight: 600;" onmouseover="this.style.background='#667eea'; this.style.color='white'" onmouseout="this.style.background='white'; this.style.color='#667eea'">üîÑ Ïã§ÏãúÍ∞Ñ</button>
                    </div>
                    <div style="display: grid; gap: 12px;">
                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px;">
                            <div style="font-size: 12px; color: #666; margin-bottom: 5px;">üì¶ 2.5kg (1,000Ïõê)</div>
                            <input type="number" class="price-input" id="price-1" placeholder="600" oninput="updateInputs()" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                        </div>
                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px;">
                            <div style="font-size: 12px; color: #666; margin-bottom: 5px;">üì¶ 5kg (5,000Ïõê)</div>
                            <input type="number" class="price-input" id="price-0" placeholder="3000" oninput="updateInputs()" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                        </div>
                        <div style="background: #f8f9fa; padding: 12px; border-radius: 8px;">
                            <div style="font-size: 12px; color: #666; margin-bottom: 5px;">üì¶ 6.3kg (25,000Ïõê)</div>
                            <input type="number" class="price-input" id="price-2" placeholder="15000" oninput="updateInputs()" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px;">
                        </div>
                    </div>
                </div>
                
                <!-- Ìà¨Ïûê Í∏àÏï° ÏûÖÎ†• -->
                <div style="margin-bottom: 25px;">
                    <h3 style="margin-bottom: 15px;">üíµ Ìà¨Ïûê Í∏àÏï°</h3>
                    <div style="background: #f8f9fa; padding: 12px; border-radius: 8px;">
                        <input type="text" id="investment-amount" placeholder="1,000,000" oninput="formatInvestmentInput()" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; font-size: 14px; text-align: center;">
                        <div style="font-size: 11px; color: #666; text-align: center; margin-top: 5px;">Ïã§Î≤Ñ</div>
                    </div>
                </div>
                
                <!-- ÏµúÏ†ÅÌôî Î≤ÑÌäº -->
                <div style="margin-bottom: 25px; text-align: center;">
                    <button class="optimize-btn" id="optimize-btn" onclick="findBothOptimalSettings()" disabled style="width: 100%; padding: 12px; font-size: 14px;">
                        üîç ÏµúÏ†ÅÌôî Î∂ÑÏÑù
                    </button>
                </div>
                
                <!-- ÏïÑÏù¥ÌÖúÎ≥Ñ Ìö®Ïú®ÏÑ± -->
                <div>
                    <h3 id="sidebar-title" style="margin-bottom: 15px;">üìä ÏïÑÏù¥ÌÖúÎ≥Ñ Ìö®Ïú®ÏÑ±</h3>
                    <div id="efficiency-list">
                        <div style="text-align: center; color: #888; padding: 20px; font-size: 12px;">
                            ÏãúÏÑ∏Î•º ÏûÖÎ†•ÌïòÎ©¥<br>Ìö®Ïú®ÏÑ±Ïù¥ ÌëúÏãúÎê©ÎãàÎã§
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="main-content">
            <!-- ÏÑ§Î™Ö ÏÑπÏÖò -->
            <div class="step-container">
                <div class="step-header">
                    <div class="step-number">üìä</div>
                    <div class="step-title">ÏïåÎπÑÏò® Î™ÖÌíà Î¨¥Ïó≠ ÏµúÏ†ÅÌôî</div>
                </div>
                <div class="step-content">
                    <div style="text-align: center; color: #666;">
                        <p style="margin-bottom: 15px;">Ïò§Î•∏Ï™Ω ÏÇ¨Ïù¥ÎìúÎ∞îÏóêÏÑú ÏãúÏÑ∏ÏôÄ Ìà¨ÏûêÍ∏àÏï°ÏùÑ ÏûÖÎ†•ÌïòÎ©¥</p>
                        <p style="margin-bottom: 15px;">Ïã§ÏãúÍ∞ÑÏúºÎ°ú ÏµúÏ†ÅÌôî Í≤∞Í≥ºÍ∞Ä ÏóÖÎç∞Ïù¥Ìä∏Îê©ÎãàÎã§</p>
                        <div style="margin-top: 20px; font-size: 14px; background: #f8f9fa; padding: 15px; border-radius: 8px;">
                            <div style="margin-bottom: 8px;">üí∞ <strong>ÏàòÏùµÎ•† ÏµúÎåÄÌôî:</strong> ÏÑ§Ï†ï Ìà¨ÏûêÍ∏àÏï° ÎÇ¥ÏóêÏÑú ÏµúÍ≥† ÏàòÏùµÎ•†</div>
                            <div>‚ö° <strong>Ìö®Ïú®ÏÑ± ÏµúÎåÄÌôî:</strong> Í∞ÄÏû• Ï†ÅÏùÄ Ìà¨ÏûêÎ°ú ÏµúÎåÄ ÏàòÏùµ</div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ÏµúÏ†ÅÌôî Í≤∞Í≥º -->
            <div class="step-container hidden" id="results-container">
                <div class="step-header">
                    <div class="step-number">üèÜ</div>
                    <div class="step-title">ÏµúÏ†ÅÌôî Í≤∞Í≥º</div>
                </div>
                <div class="step-content">
                    <div class="results-section">
                        <div class="optimal-result">
                            <h3>‚ö° Ìö®Ïú®ÏÑ± ÏµúÎåÄÌôî</h3>
                            <div id="efficiency-details"></div>
                        </div>
                        <div class="calculation-result">
                            <h3>üí∞ ÏàòÏùµÎ•† ÏµúÎåÄÌôî</h3>
                            <div id="profit-details"></div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Í≥†Ï†ïÎπÑ ÏÑ§Ï†ï -->
            <div class="step-container">
                <div class="step-header">
                    <div class="step-number">üêÇ</div>
                    <div class="step-title">Í≥†Ï†ïÎπÑ ÏÑ§Ï†ï</div>
                    <button onclick="toggleSettings()" id="settings-btn" style="margin-left: auto; padding: 8px 20px; border: 2px solid #667eea; background: white; color: #667eea; border-radius: 25px; cursor: pointer; font-weight: 600; transition: all 0.3s ease;" onmouseover="this.style.background='#667eea'; this.style.color='white'" onmouseout="this.style.background='white'; this.style.color='#667eea'">Í∞ÄÍ≤© ÏÑ§Ï†ï Î∞è Ï†ïÎ≥¥ Î≥¥Í∏∞</button>
                </div>
                <div class="step-content hidden" id="settings-panel" style="transition: all 0.3s ease;">
                    <div style="text-align: center; margin-bottom: 20px; color: #666;">
                        <p>ÌÉàÍ≤ÉÍ≥º ÌååÏù¥Ïùò Í∞ÄÍ≤©ÏùÑ ÏÑ§Ï†ïÌïòÏÑ∏Ïöî (Îπà Í∞íÏùÄ Í∏∞Î≥∏Í∞í ÏÇ¨Ïö©)</p>
                    </div>
                    
                    <!-- ÌÉàÍ≤É Î∞è ÌååÏù¥ Í∞ÄÍ≤© ÏÑ§Ï†ï -->
                    <div style="background: white; padding: 20px; border-radius: 12px; border: 2px solid #e9ecef; margin-bottom: 20px;">
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                            <h4 style="margin: 0; color: #333;">üêÇ Ìô©ÏÜå Î∞è ÌååÏù¥ Í∞ÄÍ≤© ÏÑ§Ï†ï</h4>
                            <button id="fetch-mount-btn" onclick="fetchMountAndPiePrices()" style="padding: 6px 12px; border: 1px solid #667eea; background: white; color: #667eea; border-radius: 15px; cursor: pointer; font-size: 11px; font-weight: 600;" onmouseover="this.style.background='#667eea'; this.style.color='white'" onmouseout="this.style.background='white'; this.style.color='#667eea'">üîÑ Ïã§ÏãúÍ∞Ñ</button>
                        </div>
                        
                        <!-- Ìô©ÏÜå ÏÑ§Ï†ï -->
                        <div style="display: grid; grid-template-columns: repeat(6, 1fr); gap: 15px; margin-bottom: 30px;">
                            <!-- 3Ìã∞Ïñ¥ -->
                            <div style="text-align: center;">
                                <h5 style="color: #667eea; font-weight: 600; margin-bottom: 10px;">3Ìã∞Ïñ¥</h5>
                                <div style="display: grid; gap: 8px;">
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">ÏùºÎ∞ò (1,058kg)</div>
                                        <input type="text" id="ox3_normal_price" value="13,000" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox3_normal', this.value)">
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">Ï¢ãÏùå (1,120kg)</div>
                                        <input type="text" id="ox3_good_price" value="13,000" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox3_good', this.value)">
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">Îõ∞Ïñ¥ÎÇ® (1,184kg)</div>
                                        <input type="text" id="ox3_outstanding_price" value="13,000" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox3_outstanding', this.value)">
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">Ïö∞ÏàòÌï® (1,251kg)</div>
                                        <input type="text" id="ox3_excellent_price" value="15,000" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox3_excellent', this.value)">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 4Ìã∞Ïñ¥ -->
                            <div style="text-align: center;">
                                <h5 style="color: #667eea; font-weight: 600; margin-bottom: 10px;">4Ìã∞Ïñ¥</h5>
                                <div style="display: grid; gap: 8px;">
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">ÏùºÎ∞ò (1,165kg)</div>
                                        <input type="text" id="ox4_normal_price" value="35,739" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox4_normal', this.value)">
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">Ï¢ãÏùå (1,228kg)</div>
                                        <input type="text" id="ox4_good_price" value="35,739" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox4_good', this.value)">
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">Îõ∞Ïñ¥ÎÇ® (1,294kg)</div>
                                        <input type="text" id="ox4_outstanding_price" value="42,572" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox4_outstanding', this.value)">
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">Ïö∞ÏàòÌï® (1,362kg)</div>
                                        <input type="text" id="ox4_excellent_price" value="50,754" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox4_excellent', this.value)">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 5Ìã∞Ïñ¥ -->
                            <div style="text-align: center;">
                                <h5 style="color: #667eea; font-weight: 600; margin-bottom: 10px;">5Ìã∞Ïñ¥</h5>
                                <div style="display: grid; gap: 8px;">
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">ÏùºÎ∞ò (1,338kg)</div>
                                        <input type="text" id="ox5_normal_price" value="85,633" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox5_normal', this.value)">
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">Ï¢ãÏùå (1,406kg)</div>
                                        <input type="text" id="ox5_good_price" value="85,633" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox5_good', this.value)">
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">Îõ∞Ïñ¥ÎÇ® (1,447kg)</div>
                                        <input type="text" id="ox5_outstanding_price" value="95,667" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox5_outstanding', this.value)">
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">Ïö∞ÏàòÌï® (1,551kg)</div>
                                        <input type="text" id="ox5_excellent_price" value="109,414" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox5_excellent', this.value)">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 6Ìã∞Ïñ¥ -->
                            <div style="text-align: center;">
                                <h5 style="color: #667eea; font-weight: 600; margin-bottom: 10px;">6Ìã∞Ïñ¥</h5>
                                <div style="display: grid; gap: 8px;">
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">ÏùºÎ∞ò (1,574kg)</div>
                                        <input type="text" id="ox6_normal_price" value="217,818" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox6_normal', this.value)">
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">Ï¢ãÏùå (1,651kg)</div>
                                        <input type="text" id="ox6_good_price" value="217,818" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox6_good', this.value)">
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">Îõ∞Ïñ¥ÎÇ® (1,730kg)</div>
                                        <input type="text" id="ox6_outstanding_price" value="238,917" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox6_outstanding', this.value)">
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">Ïö∞ÏàòÌï® (1,813kg)</div>
                                        <input type="text" id="ox6_excellent_price" value="264,648" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox6_excellent', this.value)">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 7Ìã∞Ïñ¥ -->
                            <div style="text-align: center;">
                                <h5 style="color: #667eea; font-weight: 600; margin-bottom: 10px;">7Ìã∞Ïñ¥</h5>
                                <div style="display: grid; gap: 8px;">
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">ÏùºÎ∞ò (1,876kg)</div>
                                        <input type="text" id="ox7_normal_price" value="570,169" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox7_normal', this.value)">
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">Ï¢ãÏùå (1,964kg)</div>
                                        <input type="text" id="ox7_good_price" value="570,169" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox7_good', this.value)">
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">Îõ∞Ïñ¥ÎÇ® (2,056kg)</div>
                                        <input type="text" id="ox7_outstanding_price" value="569,961" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox7_outstanding', this.value)">
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">Ïö∞ÏàòÌï® (2,152kg)</div>
                                        <input type="text" id="ox7_excellent_price" value="628,990" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox7_excellent', this.value)">
                                    </div>
                                </div>
                            </div>
                            
                            <!-- 8Ìã∞Ïñ¥ -->
                            <div style="text-align: center;">
                                <h5 style="color: #667eea; font-weight: 600; margin-bottom: 10px;">8Ìã∞Ïñ¥</h5>
                                <div style="display: grid; gap: 8px;">
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">ÏùºÎ∞ò (2,252kg)</div>
                                        <input type="text" id="ox8_normal_price" value="1,659,956" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox8_normal', this.value)">
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">Ï¢ãÏùå (2,355kg)</div>
                                        <input type="text" id="ox8_good_price" value="1,659,956" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox8_good', this.value)">
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">Îõ∞Ïñ¥ÎÇ® (2,462kg)</div>
                                        <input type="text" id="ox8_outstanding_price" value="1,677,557" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox8_outstanding', this.value)">
                                    </div>
                                    <div>
                                        <div style="font-size: 11px; color: #666; margin-bottom: 3px;">Ïö∞ÏàòÌï® (2,573kg)</div>
                                        <input type="text" id="ox8_excellent_price" value="1,742,522" style="width: 100%; padding: 6px; border: 1px solid #ddd; border-radius: 4px; font-size: 12px; text-align: center;" oninput="formatMountPrice('ox8_excellent', this.value)">
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <!-- ÌååÏù¥ ÏÑ§Ï†ï -->
                        <div style="border-top: 1px solid #e9ecef; padding-top: 20px;">
                            <h5 style="color: #667eea; font-weight: 600; margin-bottom: 15px; text-align: center;">ü•ß ÌååÏù¥ Î≤ÑÌîÑ</h5>
                            <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 15px;">
                                <div style="text-align: center;">
                                    <div style="font-size: 12px; color: #666; margin-bottom: 5px;">3T ÏπòÌÇ® (10% Î≤ÑÌîÑ)</div>
                                    <input type="text" id="chicken_pie_price" value="481" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px; font-size: 12px; text-align: center;" oninput="formatPiePrice('chicken', this.value)">
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 12px; color: #666; margin-bottom: 5px;">5T Í±∞ÏúÑ (20% Î≤ÑÌîÑ)</div>
                                    <input type="text" id="goose_pie_price" value="2,459" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px; font-size: 12px; text-align: center;" oninput="formatPiePrice('goose', this.value)">
                                </div>
                                <div style="text-align: center;">
                                    <div style="font-size: 12px; color: #666; margin-bottom: 5px;">7T ÎèºÏßÄ (30% Î≤ÑÌîÑ)</div>
                                    <input type="text" id="pork_pie_price" value="5,115" style="width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 6px; font-size: 12px; text-align: center;" oninput="formatPiePrice('pork', this.value)">
                                </div>
                            </div>
                        </div>
                    </div>
                    

                    <div style="text-align: center;">
                        <button onclick="resetMountPrices()" style="padding: 10px 25px; border: 2px solid #dc3545; background: white; color: #dc3545; border-radius: 25px; cursor: pointer; font-weight: 600; margin-right: 10px;">Í∏∞Î≥∏Í∞íÏúºÎ°ú Ï¥àÍ∏∞Ìôî</button>
                        <button onclick="toggleSettings()" style="padding: 10px 25px; border: 2px solid #28a745; background: white; color: #28a745; border-radius: 25px; cursor: pointer; font-weight: 600;">ÏÑ§Ï†ï ÏôÑÎ£å</button>
                    </div>
                </div>
            </div>
            </div> <!-- main-content Îã´Í∏∞ -->
        </div>
    </div>

    <script>
        let currentRate = 96;
        let isLoadingPrices = false;
        
        // API ÏÑ§Ï†ï
        const API_BASE = 'https://east.albion-online-data.com/api/v2/stats/prices';
        const TREASURE_ITEMS = 'TREASURE_RITUAL_RARITY1,TREASURE_RITUAL_RARITY2,TREASURE_RITUAL_RARITY3';
        const MOUNT_ITEMS = 'T3_MOUNT_OX,T4_MOUNT_OX,T5_MOUNT_OX,T6_MOUNT_OX,T7_MOUNT_OX,T8_MOUNT_OX';
        const PIE_ITEMS = 'T3_MEAL_PIE,T5_MEAL_PIE@1,T7_MEAL_PIE';
        const FORT_STERLING = 'Fort Sterling';
        const CAERLEON = 'Caerleon';

        const items = [
            { sellPrice: 5000, weight: 5, name: '5kg ÏïÑÏù¥ÌÖú' },
            { sellPrice: 1000, weight: 2.5, name: '2.5kg ÏïÑÏù¥ÌÖú' },
            { sellPrice: 25000, weight: 6.3, name: '6.3kg ÏïÑÏù¥ÌÖú' }
        ];

        const defaultMountPrices = {
            ox3_normal: 13000, ox3_good: 13000, ox3_outstanding: 13000, ox3_excellent: 15000,
            ox4_normal: 35739, ox4_good: 35739, ox4_outstanding: 42572, ox4_excellent: 50754,
            ox5_normal: 85633, ox5_good: 85633, ox5_outstanding: 95667, ox5_excellent: 109414,
            ox6_normal: 217818, ox6_good: 217818, ox6_outstanding: 238917, ox6_excellent: 264648,
            ox7_normal: 570169, ox7_good: 570169, ox7_outstanding: 569961, ox7_excellent: 628990,
            ox8_normal: 1659956, ox8_good: 1659956, ox8_outstanding: 1677557, ox8_excellent: 1742522
        };

        const defaultPiePrices = {
            chicken: 481, goose: 2459, pork: 5115
        };

        const mounts = {
            ox3_normal: { capacity: 1058, price: 13000, name: '3Ìã∞Ïñ¥ Ìô©ÏÜå ÏùºÎ∞ò' },
            ox3_good: { capacity: 1120, price: 13000, name: '3Ìã∞Ïñ¥ Ìô©ÏÜå Ï¢ãÏùå' },
            ox3_outstanding: { capacity: 1184, price: 13000, name: '3Ìã∞Ïñ¥ Ìô©ÏÜå Îõ∞Ïñ¥ÎÇ®' },
            ox3_excellent: { capacity: 1251, price: 15000, name: '3Ìã∞Ïñ¥ Ìô©ÏÜå Ïö∞ÏàòÌï®' },
            
            ox4_normal: { capacity: 1165, price: 35739, name: '4Ìã∞Ïñ¥ Ìô©ÏÜå ÏùºÎ∞ò' },
            ox4_good: { capacity: 1228, price: 35739, name: '4Ìã∞Ïñ¥ Ìô©ÏÜå Ï¢ãÏùå' },
            ox4_outstanding: { capacity: 1294, price: 42572, name: '4Ìã∞Ïñ¥ Ìô©ÏÜå Îõ∞Ïñ¥ÎÇ®' },
            ox4_excellent: { capacity: 1362, price: 50754, name: '4Ìã∞Ïñ¥ Ìô©ÏÜå Ïö∞ÏàòÌï®' },
            
            ox5_normal: { capacity: 1338, price: 85633, name: '5Ìã∞Ïñ¥ Ìô©ÏÜå ÏùºÎ∞ò' },
            ox5_good: { capacity: 1406, price: 85633, name: '5Ìã∞Ïñ¥ Ìô©ÏÜå Ï¢ãÏùå' },
            ox5_outstanding: { capacity: 1447, price: 95667, name: '5Ìã∞Ïñ¥ Ìô©ÏÜå Îõ∞Ïñ¥ÎÇ®' },
            ox5_excellent: { capacity: 1551, price: 109414, name: '5Ìã∞Ïñ¥ Ìô©ÏÜå Ïö∞ÏàòÌï®' },
            
            ox6_normal: { capacity: 1574, price: 217818, name: '6Ìã∞Ïñ¥ Ìô©ÏÜå ÏùºÎ∞ò' },
            ox6_good: { capacity: 1651, price: 217818, name: '6Ìã∞Ïñ¥ Ìô©ÏÜå Ï¢ãÏùå' },
            ox6_outstanding: { capacity: 1730, price: 238917, name: '6Ìã∞Ïñ¥ Ìô©ÏÜå Îõ∞Ïñ¥ÎÇ®' },
            ox6_excellent: { capacity: 1813, price: 264648, name: '6Ìã∞Ïñ¥ Ìô©ÏÜå Ïö∞ÏàòÌï®' },
            
            ox7_normal: { capacity: 1876, price: 570169, name: '7Ìã∞Ïñ¥ Ìô©ÏÜå ÏùºÎ∞ò' },
            ox7_good: { capacity: 1964, price: 570169, name: '7Ìã∞Ïñ¥ Ìô©ÏÜå Ï¢ãÏùå' },
            ox7_outstanding: { capacity: 2056, price: 569961, name: '7Ìã∞Ïñ¥ Ìô©ÏÜå Îõ∞Ïñ¥ÎÇ®' },
            ox7_excellent: { capacity: 2152, price: 628990, name: '7Ìã∞Ïñ¥ Ìô©ÏÜå Ïö∞ÏàòÌï®' },
            
            ox8_normal: { capacity: 2252, price: 1659956, name: '8Ìã∞Ïñ¥ Ìô©ÏÜå ÏùºÎ∞ò' },
            ox8_good: { capacity: 2355, price: 1659956, name: '8Ìã∞Ïñ¥ Ìô©ÏÜå Ï¢ãÏùå' },
            ox8_outstanding: { capacity: 2462, price: 1677557, name: '8Ìã∞Ïñ¥ Ìô©ÏÜå Îõ∞Ïñ¥ÎÇ®' },
            ox8_excellent: { capacity: 2573, price: 1742522, name: '8Ìã∞Ïñ¥ Ìô©ÏÜå Ïö∞ÏàòÌï®' }
        };

        const pies = {
            none: { buff: 0, price: 0, name: 'ÏÇ¨Ïö© ÏïàÌï®' },
            chicken: { buff: 10, price: 481, name: '3Ìã∞Ïñ¥ ÏπòÌÇ® ÌååÏù¥' },
            goose: { buff: 20, price: 2459, name: '5Ìã∞Ïñ¥ Í±∞ÏúÑ ÌååÏù¥' },
            pork: { buff: 30, price: 5115, name: '7Ìã∞Ïñ¥ ÎèºÏßÄÍ≥†Í∏∞ ÌååÏù¥' }
        };

        function setMode(rate) {
            currentRate = rate;
            
            document.querySelectorAll('.mode-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            updateInputs();
        }

        function updateInputs() {
            const prices = [
                parseFloat(document.getElementById('price-0').value) || 0,
                parseFloat(document.getElementById('price-1').value) || 0,
                parseFloat(document.getElementById('price-2').value) || 0
            ];
            
            const investment = getInvestmentValue();
            
            const hasPrice = prices.some(price => price > 0);
            const hasInvestment = investment > 0;
            
            const optimizeBtn = document.getElementById('optimize-btn');
            optimizeBtn.disabled = !(hasPrice && hasInvestment);
            
            // ÏïÑÏù¥ÌÖúÎ≥Ñ Ìö®Ïú®ÏÑ± ÏóÖÎç∞Ïù¥Ìä∏
            updateItemEfficiencies(prices);
            
            // Í≤∞Í≥ºÍ∞Ä Ïù¥ÎØ∏ ÌëúÏãúÎêú ÏÉÅÌÉúÎùºÎ©¥ ÏûêÎèôÏúºÎ°ú ÏóÖÎç∞Ïù¥Ìä∏
            const resultsContainer = document.getElementById('results-container');
            if (!resultsContainer.classList.contains('hidden') && hasPrice && hasInvestment) {
                findBothOptimalSettings();
            }
        }
        


        function findBothOptimalSettings() {
            const efficiencySetting = findOptimalSetting('efficiency');
            const profitSetting = findOptimalSetting('profit');
            
            if (efficiencySetting && profitSetting) {
                displayBothResults(efficiencySetting, profitSetting);
            } else {
                alert('ÏµúÏ†Å ÏÑ∏ÌåÖÏùÑ Ï∞æÏùÑ Ïàò ÏóÜÏäµÎãàÎã§.');
            }
        }
        
        function findOptimalSetting(mode) {
            const investmentAmount = getInvestmentValue();
            const itemPrices = [
                parseFloat(document.getElementById('price-0').value) || 0,
                parseFloat(document.getElementById('price-1').value) || 0,
                parseFloat(document.getElementById('price-2').value) || 0
            ];
            
            let bestSetting = null;
            let bestScore = mode === 'efficiency' ? -Infinity : -Infinity;
            
            // Î™®Îì† ÌÉàÍ≤É/ÌååÏù¥ Ï°∞Ìï© ÌÖåÏä§Ìä∏
            Object.keys(mounts).forEach(mountKey => {
                Object.keys(pies).forEach(pieKey => {
                    const mount = mounts[mountKey];
                    const pie = pies[pieKey];
                    const actualCapacity = Math.floor(mount.capacity * (1 + pie.buff / 100));
                    const fixedCost = mount.price + pie.price;
                    
                    // Í∞Å ÏïÑÏù¥ÌÖúÏóê ÎåÄÌï¥ ÏµúÏ†Å ÏàòÎüâ Í≥ÑÏÇ∞
                    items.forEach((item, itemIndex) => {
                        const itemPrice = itemPrices[itemIndex];
                        if (itemPrice <= 0) return;
                        
                        let maxQuantity, totalInvestment, availableForItems;
                        
                        // Îëê Î™®Îìú Î™®Îëê Ìà¨ÏûêÍ∏àÏï° ÎÇ¥ÏóêÏÑú Í≥ÑÏÇ∞
                        if (fixedCost >= investmentAmount) return;
                        availableForItems = investmentAmount - fixedCost;
                        const maxByMoney = Math.floor(availableForItems / itemPrice);
                        const maxByWeight = Math.floor(actualCapacity / item.weight);
                        maxQuantity = Math.min(maxByMoney, maxByWeight);
                        totalInvestment = fixedCost + (maxQuantity * itemPrice);
                        
                        if (maxQuantity <= 0) return;
                        
                        const totalItemCost = maxQuantity * itemPrice;
                        const revenue = maxQuantity * item.sellPrice * (currentRate / 100);
                        const profit = revenue - totalItemCost - fixedCost;
                        
                        let score;
                        if (mode === 'efficiency') {
                            // Ìö®Ïú®ÏÑ±: Ïã§Ï†ú Ìà¨Ïûê ÎåÄÎπÑ ÏàòÏùµ ÎπÑÏú® (Ï†ÅÏùÄ Ìà¨ÏûêÎ°ú ÎÜíÏùÄ ÏàòÏùµ)
                            score = totalInvestment > 0 ? profit / totalInvestment : 0;
                        } else {
                            // ÏàòÏùµÎ•†: ÏÑ§Ï†ïÎêú Ìà¨ÏûêÍ∏àÏï° ÎåÄÎπÑ ÏàòÏùµÎ•†
                            score = (profit / investmentAmount) * 100;
                        }
                        
                        if (score > bestScore) {
                            bestScore = score;
                            bestSetting = {
                                mode, mountKey, pieKey, itemIndex, quantity: maxQuantity,
                                mount, pie, item, actualCapacity, fixedCost,
                                totalItemCost, revenue, profit, 
                                totalInvestment: totalInvestment,
                                efficiency: (profit / totalInvestment) * 100,
                                itemPrice, score
                            };
                        }
                    });
                });
            });
            
            return bestSetting;
        }

        function displayBothResults(efficiencySetting, profitSetting) {
            const t = translations[currentLanguage];
            const isKo = currentLanguage === 'ko';
            
            // Í≤∞Í≥º Ï†úÎ™© ÏóÖÎç∞Ïù¥Ìä∏
            document.querySelector('.optimal-result h3').textContent = t.efficiencyTitle;
            document.querySelector('.calculation-result h3').textContent = t.profitTitle;
            
            // Ìö®Ïú®ÏÑ± ÏµúÎåÄÌôî Í≤∞Í≥º
            document.getElementById('efficiency-details').innerHTML = `
                <div style="text-align: center; margin-bottom: 15px; font-size: 14px; opacity: 0.8;">
                    ${isKo ? 'Í∞ÄÏû• Ï†ÅÏùÄ Ìà¨ÏûêÎ°ú ÏµúÎåÄ ÏàòÏùµ' : 'Maximum profit with minimal investment'}
                </div>
                <div class="optimal-details">
                    <strong>${isKo ? 'üêÇ ÌÉàÍ≤É:' : 'üêÇ Mount:'}</strong> ${isKo ? efficiencySetting.mount.name : efficiencySetting.mount.name.replace(/Ìã∞Ïñ¥|Ìô©ÏÜå|ÏùºÎ∞ò|Ï¢ãÏùå|Îõ∞Ïñ¥ÎÇ®|Ïö∞ÏàòÌï®/g, m => ({'Ìã∞Ïñ¥':'T','Ìô©ÏÜå':'Ox','ÏùºÎ∞ò':'Normal','Ï¢ãÏùå':'Good','Îõ∞Ïñ¥ÎÇ®':'Outstanding','Ïö∞ÏàòÌï®':'Excellent'}[m]))}<br>
                    <strong>${isKo ? 'ü•ß Î≤ÑÌîÑ:' : 'ü•ß Buff:'}</strong> ${isKo ? efficiencySetting.pie.name : efficiencySetting.pie.name.replace(/Ìã∞Ïñ¥|ÏπòÌÇ® ÌååÏù¥|Í±∞ÏúÑ ÌååÏù¥|ÎèºÏßÄÍ≥†Í∏∞ ÌååÏù¥|ÏÇ¨Ïö© ÏïàÌï®/g, m => ({'Ìã∞Ïñ¥':'T','ÏπòÌÇ® ÌååÏù¥':'Chicken Pie','Í±∞ÏúÑ ÌååÏù¥':'Goose Pie','ÎèºÏßÄÍ≥†Í∏∞ ÌååÏù¥':'Pork Pie','ÏÇ¨Ïö© ÏïàÌï®':'None'}[m]))}<br>
                    <strong>${isKo ? 'üì¶ ÏïÑÏù¥ÌÖú:' : 'üì¶ Item:'}</strong> ${isKo ? efficiencySetting.item.name : efficiencySetting.item.name.replace('ÏïÑÏù¥ÌÖú', 'Item')} √ó ${efficiencySetting.quantity}${isKo ? 'Í∞ú' : ' items'}<br>
                    <strong>${isKo ? 'üìè ÏµúÎåÄÏ†ÅÏû¨Îüâ:' : 'üìè Max Capacity:'}</strong> ${efficiencySetting.actualCapacity}kg
                </div>
                <div style="margin-top: 15px; padding-top: 15px; border-top: 1px solid rgba(255,255,255,0.3);">
                    <div class="result-item" style="color: white; border: none; padding: 5px 0;">
                        <span>${isKo ? 'üí∞ Ìà¨ÏûêÍ∏à:' : 'üí∞ Investment:'}</span>
                        <span style="font-weight: bold;">${efficiencySetting.totalInvestment.toLocaleString()}${isKo ? 'Ïã§Î≤Ñ' : ' Silver'}</span>
                    </div>
                    <div class="result-item" style="color: white; border: none; padding: 5px 0;">
                        <span>${isKo ? 'üìà ÏàúÏù¥Ïùµ:' : 'üìà Net Profit:'}</span>
                        <span style="font-weight: bold;">${Math.round(efficiencySetting.profit).toLocaleString()}${isKo ? 'Ïã§Î≤Ñ' : ' Silver'}</span>
                    </div>
                    <div class="result-item" style="color: white; border: none; padding: 5px 0;">
                        <span>${isKo ? 'üéØ ÏàòÏùµÎ•†:' : 'üéØ Profit Rate:'}</span>
                        <span style="font-weight: bold;">${efficiencySetting.efficiency.toFixed(1)}%</span>
                    </div>
                </div>
            `;
            
            // ÏàòÏùµÎ•† ÏµúÎåÄÌôî Í≤∞Í≥º
            document.getElementById('profit-details').innerHTML = `
                <div style="text-align: center; margin-bottom: 15px; font-size: 14px; color: #666;">
                    ${isKo ? 'ÏÑ§Ï†ï Ìà¨ÏûêÍ∏àÏï° ÎåÄÎπÑ ÏµúÍ≥† ÏàòÏùµÎ•†' : 'Highest profit rate within set investment'}
                </div>
                <div style="background: #f8f9fa; padding: 15px; border-radius: 8px; margin-bottom: 15px;">
                    <strong>${isKo ? 'üêÇ ÌÉàÍ≤É:' : 'üêÇ Mount:'}</strong> ${isKo ? profitSetting.mount.name : profitSetting.mount.name.replace(/Ìã∞Ïñ¥|Ìô©ÏÜå|ÏùºÎ∞ò|Ï¢ãÏùå|Îõ∞Ïñ¥ÎÇ®|Ïö∞ÏàòÌï®/g, m => ({'Ìã∞Ïñ¥':'T','Ìô©ÏÜå':'Ox','ÏùºÎ∞ò':'Normal','Ï¢ãÏùå':'Good','Îõ∞Ïñ¥ÎÇ®':'Outstanding','Ïö∞ÏàòÌï®':'Excellent'}[m]))}<br>
                    <strong>${isKo ? 'ü•ß Î≤ÑÌîÑ:' : 'ü•ß Buff:'}</strong> ${isKo ? profitSetting.pie.name : profitSetting.pie.name.replace(/Ìã∞Ïñ¥|ÏπòÌÇ® ÌååÏù¥|Í±∞ÏúÑ ÌååÏù¥|ÎèºÏßÄÍ≥†Í∏∞ ÌååÏù¥|ÏÇ¨Ïö© ÏïàÌï®/g, m => ({'Ìã∞Ïñ¥':'T','ÏπòÌÇ® ÌååÏù¥':'Chicken Pie','Í±∞ÏúÑ ÌååÏù¥':'Goose Pie','ÎèºÏßÄÍ≥†Í∏∞ ÌååÏù¥':'Pork Pie','ÏÇ¨Ïö© ÏïàÌï®':'None'}[m]))}<br>
                    <strong>${isKo ? 'üì¶ ÏïÑÏù¥ÌÖú:' : 'üì¶ Item:'}</strong> ${isKo ? profitSetting.item.name : profitSetting.item.name.replace('ÏïÑÏù¥ÌÖú', 'Item')} √ó ${profitSetting.quantity}${isKo ? 'Í∞ú' : ' items'}<br>
                    <strong>${isKo ? 'üìè ÏµúÎåÄÏ†ÅÏû¨Îüâ:' : 'üìè Max Capacity:'}</strong> ${profitSetting.actualCapacity}kg
                </div>
                <div class="result-item">
                    <span class="result-label">${isKo ? 'üí∞ Ìà¨ÏûêÍ∏à' : 'üí∞ Investment'}</span>
                    <span class="result-value">${profitSetting.totalInvestment.toLocaleString()}${isKo ? 'Ïã§Î≤Ñ' : ' Silver'}</span>
                </div>
                <div class="result-item">
                    <span class="result-label">${isKo ? 'üìà ÏàúÏù¥Ïùµ' : 'üìà Net Profit'}</span>
                    <span class="result-value ${profitSetting.profit >= 0 ? 'profit-positive' : 'profit-negative'}">
                        ${Math.round(profitSetting.profit).toLocaleString()}${isKo ? 'Ïã§Î≤Ñ' : ' Silver'}
                    </span>
                </div>
                <div class="result-item">
                    <span class="result-label">${isKo ? 'üéØ ÏàòÏùµÎ•†' : 'üéØ Profit Rate'}</span>
                    <span class="result-value ${profitSetting.efficiency >= 0 ? 'profit-positive' : 'profit-negative'}">
                        ${profitSetting.efficiency.toFixed(1)}%
                    </span>
                </div>
            `;
            
            document.getElementById('results-container').classList.remove('hidden');
        }

        function formatInvestmentInput() {
            const input = document.getElementById('investment-amount');
            const cursorPosition = input.selectionStart;
            const oldValue = input.value;
            
            let value = input.value.replace(/,/g, '');
            if (value === '' || isNaN(value)) {
                updateInputs();
                return;
            }
            
            const newValue = parseInt(value).toLocaleString();
            input.value = newValue;
            
            // Ïª§ÏÑú ÏúÑÏπò Ï°∞Ï†ï - ÏΩ§Îßà Í∞úÏàò Î≥ÄÌôî Í≥†Î†§
            const oldCommas = (oldValue.match(/,/g) || []).length;
            const newCommas = (newValue.match(/,/g) || []).length;
            const commaDiff = newCommas - oldCommas;
            
            const newCursorPosition = Math.max(0, Math.min(newValue.length, cursorPosition + commaDiff));
            input.setSelectionRange(newCursorPosition, newCursorPosition);
            
            updateInputs();
        }

        function getInvestmentValue() {
            const value = document.getElementById('investment-amount').value.replace(/,/g, '');
            return parseFloat(value) || 0;
        }

        let currentLanguage = 'ko';
        
        const translations = {
            ko: {
                contractMode: 'Íµ¨Îß§Í≥ÑÏïΩÏÑú (93.5%)',
                normalMode: 'ÏùºÎ∞ò Í±∞Îûò (96%)',
                optimizeBtn: 'üîç ÏµúÏ†ÅÌôî Î∂ÑÏÑù',
                efficiencyTitle: '‚ö° Ìö®Ïú®ÏÑ± ÏµúÎåÄÌôî',
                profitTitle: 'üí∞ ÏàòÏùµÎ•† ÏµúÎåÄÌôî',
                settingsOpen: 'Í∞ÄÍ≤© ÏÑ§Ï†ï Î∞è Ï†ïÎ≥¥ Î≥¥Í∏∞',
                settingsClose: 'Í∞ÄÍ≤© ÏÑ§Ï†ï Î∞è Ï†ïÎ≥¥ Îã´Í∏∞',
                efficiencyTitle: 'üìä ÏïÑÏù¥ÌÖúÎ≥Ñ Ìö®Ïú®ÏÑ±'
            },
            en: {
                contractMode: 'Purchase Contract (93.5%)',
                normalMode: 'Normal Trade (96%)',
                optimizeBtn: 'üîç Analyze Optimal Settings',
                efficiencyTitle: '‚ö° Efficiency Maximization',
                profitTitle: 'üí∞ Profit Maximization',
                settingsOpen: 'Price Settings & Info',
                settingsClose: 'Close Settings & Info',
                efficiencyTitle: 'üìä Item Efficiency'
            }
        };
        
        function setLanguage(lang) {
            currentLanguage = lang;
            const t = translations[lang];
            
            // Î™®Îìú Î≤ÑÌäº
            const modeBtns = document.querySelectorAll('.mode-btn');
            if (modeBtns[0]) modeBtns[0].textContent = t.contractMode;
            if (modeBtns[1]) modeBtns[1].textContent = t.normalMode;
            
            // ÏµúÏ†ÅÌôî Î≤ÑÌäº
            const optimizeBtn = document.getElementById('optimize-btn');
            if (optimizeBtn) optimizeBtn.textContent = t.optimizeBtn;
            
            // ÏÑ§Ï†ï Î≤ÑÌäº
            const settingsPanel = document.getElementById('settings-panel');
            const settingsBtn = document.getElementById('settings-btn');
            if (settingsBtn && settingsPanel) {
                settingsBtn.textContent = settingsPanel.classList.contains('hidden') ? t.settingsOpen : t.settingsClose;
            }
            
            // ÏÇ¨Ïù¥ÎìúÎ∞î Ï†úÎ™©
            const sidebarTitle = document.getElementById('sidebar-title');
            if (sidebarTitle) sidebarTitle.textContent = t.efficiencyTitle;
            
            // Ïñ∏Ïñ¥ Î≤ÑÌäº Ïä§ÌÉÄÏùº
            const langKo = document.getElementById('lang-ko');
            const langEn = document.getElementById('lang-en');
            
            langKo.style.background = lang === 'ko' ? 'white' : 'transparent';
            langKo.style.color = lang === 'ko' ? '#667eea' : 'white';
            langKo.style.borderColor = lang === 'ko' ? 'white' : 'rgba(255,255,255,0.5)';
            
            langEn.style.background = lang === 'en' ? 'white' : 'transparent';
            langEn.style.color = lang === 'en' ? '#667eea' : 'white';
            langEn.style.borderColor = lang === 'en' ? 'white' : 'rgba(255,255,255,0.5)';
            
            updateInputs();
        }
        
        function toggleSettings() {
            const panel = document.getElementById('settings-panel');
            const btn = document.getElementById('settings-btn');
            const t = translations[currentLanguage];
            
            panel.classList.toggle('hidden');
            btn.textContent = panel.classList.contains('hidden') ? t.settingsOpen : t.settingsClose;
        }
        function formatMountPrice(mountKey, value) {
            const input = document.getElementById(mountKey + '_price');
            const cursorPosition = input.selectionStart;
            const oldValue = input.value;
            
            let cleanValue = value.replace(/,/g, '');
            if (cleanValue === '' || isNaN(cleanValue)) {
                mounts[mountKey].price = defaultMountPrices[mountKey];
                return;
            }
            
            const numericValue = parseInt(cleanValue);
            const formattedValue = numericValue.toLocaleString();
            input.value = formattedValue;
            
            // Ïª§ÏÑú ÏúÑÏπò Ï°∞Ï†ï
            const oldCommas = (oldValue.match(/,/g) || []).length;
            const newCommas = (formattedValue.match(/,/g) || []).length;
            const commaDiff = newCommas - oldCommas;
            const newCursorPosition = Math.max(0, Math.min(formattedValue.length, cursorPosition + commaDiff));
            input.setSelectionRange(newCursorPosition, newCursorPosition);
            
            mounts[mountKey].price = numericValue;
        }

        function formatPiePrice(pieKey, value) {
            const input = document.getElementById(pieKey + '_pie_price');
            const cursorPosition = input.selectionStart;
            const oldValue = input.value;
            
            let cleanValue = value.replace(/,/g, '');
            if (cleanValue === '' || isNaN(cleanValue)) {
                pies[pieKey].price = defaultPiePrices[pieKey];
                return;
            }
            
            const numericValue = parseInt(cleanValue);
            const formattedValue = numericValue.toLocaleString();
            input.value = formattedValue;
            
            // Ïª§ÏÑú ÏúÑÏπò Ï°∞Ï†ï
            const oldCommas = (oldValue.match(/,/g) || []).length;
            const newCommas = (formattedValue.match(/,/g) || []).length;
            const commaDiff = newCommas - oldCommas;
            const newCursorPosition = Math.max(0, Math.min(formattedValue.length, cursorPosition + commaDiff));
            input.setSelectionRange(newCursorPosition, newCursorPosition);
            
            pies[pieKey].price = numericValue;
        }

        // APIÏóêÏÑú Í∞ÄÍ≤© Îç∞Ïù¥ÌÑ∞ Í∞ÄÏ†∏Ïò§Í∏∞
        async function fetchPrices() {
            if (isLoadingPrices) return;
            isLoadingPrices = true;
            
            const btn = document.getElementById('fetch-btn');
            btn.textContent = '‚è≥ Î°úÎî©Ï§ë...';
            btn.disabled = true;
            
            try {
                // Î™ÖÌíà ÏïÑÏù¥ÌÖú Í∞ÄÍ≤© (Ìè¨Ìä∏ Ïä§ÌÖîÎßÅÏóêÏÑú Íµ¨Îß§)
                const treasureResponse = await fetch(`${API_BASE}/${TREASURE_ITEMS}.json?locations=${FORT_STERLING}&qualities=1`);
                const treasureData = await treasureResponse.json();
                
                // Îç∞Ïù¥ÌÑ∞ ÏóÖÎç∞Ïù¥Ìä∏
                updateTreasurePrices(treasureData);
                
                // ÏûÖÎ†• ÌïÑÎìú ÏóÖÎç∞Ïù¥Ìä∏
                updateInputs();
                
                // ÏÑ±Í≥µ Î©îÏãúÏßÄ
                btn.textContent = '‚úì ÏóÖÎç∞Ïù¥Ìä∏ ÏôÑÎ£å';
                btn.style.background = '#28a745';
                btn.style.color = 'white';
                btn.style.borderColor = '#28a745';
                
                setTimeout(() => {
                    btn.textContent = 'üîÑ Ïã§ÏãúÍ∞Ñ';
                    btn.style.background = 'white';
                    btn.style.color = '#667eea';
                    btn.style.borderColor = '#667eea';
                }, 2000);
                
            } catch (error) {
                console.error('Í∞ÄÍ≤© Îç∞Ïù¥ÌÑ∞ Î°úÎìú Ïã§Ìå®:', error);
                
                // Ïã§Ìå® Î©îÏãúÏßÄ
                btn.textContent = '‚ùå Ïó∞Í≤∞ Ïã§Ìå®';
                btn.style.background = '#dc3545';
                btn.style.color = 'white';
                btn.style.borderColor = '#dc3545';
                
                setTimeout(() => {
                    btn.textContent = 'üîÑ Ïã§ÏãúÍ∞Ñ';
                    btn.style.background = 'white';
                    btn.style.color = '#667eea';
                    btn.style.borderColor = '#667eea';
                }, 3000);
                
            } finally {
                isLoadingPrices = false;
                btn.disabled = false;
            }
        }
        
        function updateTreasurePrices(data) {
            const priceMap = {
                'TREASURE_RITUAL_RARITY2': 'price-0',
                'TREASURE_RITUAL_RARITY1': 'price-1',
                'TREASURE_RITUAL_RARITY3': 'price-2'
            };
            
            data.forEach(item => {
                const inputId = priceMap[item.item_id];
                if (inputId && item.sell_price_min > 0) {
                    document.getElementById(inputId).value = item.sell_price_min;
                }
            });
        }
        
        function resetMountPrices() {
            Object.keys(defaultMountPrices).forEach(key => {
                mounts[key].price = defaultMountPrices[key];
                const input = document.getElementById(key + '_price');
                if (input) input.value = defaultMountPrices[key].toLocaleString();
            });
            Object.keys(defaultPiePrices).forEach(key => {
                pies[key].price = defaultPiePrices[key];
                const input = document.getElementById(key + '_pie_price');
                if (input) input.value = defaultPiePrices[key].toLocaleString();
            });
        }

        function updateItemEfficiencies(prices) {
            const efficiencyList = document.getElementById('efficiency-list');
            const t = translations[currentLanguage];
            const isKo = currentLanguage === 'ko';
            
            if (!prices.some(p => p > 0)) {
                efficiencyList.innerHTML = `
                    <div style="text-align: center; color: #888; padding: 20px;">
                        ${isKo ? 'ÏïÑÏù¥ÌÖú Í∞ÄÍ≤©ÏùÑ ÏûÖÎ†•ÌïòÎ©¥<br>Ìö®Ïú®ÏÑ±Ïù¥ ÌëúÏãúÎê©ÎãàÎã§' : 'Enter item prices to see<br>efficiency comparison'}
                    </div>
                `;
                return;
            }
            
            const efficiencies = [];
            
            items.forEach((item, index) => {
                const itemPrice = prices[index];
                if (itemPrice <= 0) return;
                
                const revenue = item.sellPrice * (currentRate / 100);
                const profit = revenue - itemPrice;
                const profitPerKg = profit / item.weight;
                const profitPerSilver = profit / itemPrice;
                
                efficiencies.push({
                    item,
                    itemPrice,
                    profit,
                    profitPerKg,
                    profitPerSilver,
                    index
                });
            });
            
            // kgÎãπ ÏàòÏùµÏúºÎ°ú Ï†ïÎ†¨
            efficiencies.sort((a, b) => b.profitPerKg - a.profitPerKg);
            
            let html = '';
            efficiencies.forEach((eff, rank) => {
                const isBest = rank === 0;
                const itemName = isKo ? eff.item.name : eff.item.name.replace('ÏïÑÏù¥ÌÖú', 'Item');
                
                html += `
                    <div class="efficiency-item ${isBest ? 'best' : ''}">
                        <h4>${isBest ? 'üèÜ ' : ''}${itemName}</h4>
                        <div class="efficiency-stats">
                            <span>${isKo ? 'kgÎãπ ÏàòÏùµ:' : 'Profit/kg:'}</span>
                            <span class="efficiency-value ${isBest ? 'best' : ''}">${Math.round(eff.profitPerKg).toLocaleString()}</span>
                        </div>
                        <div class="efficiency-stats">
                            <span>${isKo ? 'Ïã§Î≤ÑÎãπ ÏàòÏùµ:' : 'Profit/Silver:'}</span>
                            <span class="efficiency-value ${isBest ? 'best' : ''}">${(eff.profitPerSilver * 100).toFixed(1)}%</span>
                        </div>
                        <div class="efficiency-stats">
                            <span>${isKo ? 'Í∞ÄÍ≤©:' : 'Price:'}</span>
                            <span>${eff.itemPrice.toLocaleString()}${isKo ? 'Ïã§Î≤Ñ' : ' Silver'}</span>
                        </div>
                    </div>
                `;
            });
            
            efficiencyList.innerHTML = html;
        }
        
        async function fetchMountAndPiePrices() {
            const fetchBtn = document.getElementById('fetch-mount-btn');
            const originalText = fetchBtn.innerHTML;
            fetchBtn.innerHTML = '‚è≥ Î°úÎî©...';
            fetchBtn.disabled = true;
            
            try {
                // ÌÉàÍ≤É Í∞ÄÍ≤© Í∞ÄÏ†∏Ïò§Í∏∞ (Ìè¨Ìä∏ Ïä§ÌÖîÎßÅÏóêÏÑú Íµ¨Îß§Í∞Ä)
                const mountResponse = await fetch(`${API_BASE}/${MOUNT_ITEMS}?locations=${FORT_STERLING}&qualities=1,2,3,4`);
                const mountData = await mountResponse.json();
                
                // ÌååÏù¥ Í∞ÄÍ≤© Í∞ÄÏ†∏Ïò§Í∏∞ (Ìè¨Ìä∏ Ïä§ÌÖîÎßÅÏóêÏÑú Íµ¨Îß§Í∞Ä)
                const pieResponse = await fetch(`${API_BASE}/${PIE_ITEMS}?locations=${FORT_STERLING}`);
                const pieData = await pieResponse.json();
                
                // ÌÉàÍ≤É Í∞ÄÍ≤© ÏóÖÎç∞Ïù¥Ìä∏
                const mountMapping = {
                    'T3_MOUNT_OX': ['ox3_normal', 'ox3_good', 'ox3_outstanding', 'ox3_excellent'],
                    'T4_MOUNT_OX': ['ox4_normal', 'ox4_good', 'ox4_outstanding', 'ox4_excellent'],
                    'T5_MOUNT_OX': ['ox5_normal', 'ox5_good', 'ox5_outstanding', 'ox5_excellent'],
                    'T6_MOUNT_OX': ['ox6_normal', 'ox6_good', 'ox6_outstanding', 'ox6_excellent'],
                    'T7_MOUNT_OX': ['ox7_normal', 'ox7_good', 'ox7_outstanding', 'ox7_excellent'],
                    'T8_MOUNT_OX': ['ox8_normal', 'ox8_good', 'ox8_outstanding', 'ox8_excellent']
                };
                
                Object.entries(mountMapping).forEach(([itemId, qualities]) => {
                    qualities.forEach((qualityId, index) => {
                        const quality = index + 1;
                        const itemData = mountData.find(item => 
                            item.item_id === itemId && 
                            item.city === FORT_STERLING &&
                            item.quality === quality
                        );
                        
                        if (itemData && itemData.sell_price_min > 0) {
                            const input = document.getElementById(qualityId + '_price');
                            if (input) {
                                input.value = itemData.sell_price_min.toLocaleString();
                                mounts[qualityId].price = itemData.sell_price_min;
                            }
                        }
                    });
                });
                
                // ÌååÏù¥ Í∞ÄÍ≤© ÏóÖÎç∞Ïù¥Ìä∏
                const pieMapping = {
                    'T3_MEAL_PIE': 'chicken',
                    'T5_MEAL_PIE@1': 'goose',
                    'T7_MEAL_PIE': 'pork'
                };
                
                Object.entries(pieMapping).forEach(([itemId, pieType]) => {
                    const itemData = pieData.find(item => 
                        item.item_id === itemId && 
                        item.city === FORT_STERLING
                    );
                    
                    if (itemData && itemData.sell_price_min > 0) {
                        const input = document.getElementById(pieType + '_pie_price');
                        if (input) {
                            input.value = itemData.sell_price_min.toLocaleString();
                            pies[pieType].price = itemData.sell_price_min;
                        }
                    }
                });
                
                // ÏÑ±Í≥µ Î©îÏãúÏßÄ
                fetchBtn.innerHTML = '‚úì ÏôÑÎ£å';
                fetchBtn.style.background = '#28a745';
                fetchBtn.style.color = 'white';
                
                setTimeout(() => {
                    fetchBtn.innerHTML = originalText;
                    fetchBtn.style.background = 'white';
                    fetchBtn.style.color = '#667eea';
                }, 2000);
                
            } catch (error) {
                console.error('ÌÉàÍ≤É/ÌååÏù¥ Í∞ÄÍ≤© Ï†ïÎ≥¥Î•º Í∞ÄÏ†∏Ïò§ÎäîÎç∞ Ïã§Ìå®ÌñàÏäµÎãàÎã§:', error);
                
                // Ïã§Ìå® Î©îÏãúÏßÄ
                fetchBtn.innerHTML = '‚ùå Ïã§Ìå®';
                fetchBtn.style.background = '#dc3545';
                fetchBtn.style.color = 'white';
                
                setTimeout(() => {
                    fetchBtn.innerHTML = originalText;
                    fetchBtn.style.background = 'white';
                    fetchBtn.style.color = '#667eea';
                }, 3000);
                
            } finally {
                fetchBtn.disabled = false;
            }
        }

        // ÌéòÏù¥ÏßÄ Î°úÎìúÏãú Ï¥àÍ∏∞ ÏÑ§Ï†ï
        window.onload = function() {
            document.getElementById('investment-amount').value = '1,000,000';
            document.getElementById('price-0').value = 2500;
            document.getElementById('price-1').value = 500;
            document.getElementById('price-2').value = 12500;
            updateInputs();
            fetchPrices();
        };
    </script>
</body>
</html>
